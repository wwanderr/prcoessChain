@echo off
chcp 65001 >nul
echo ========================================
echo 验证日志累积优化效果
echo ========================================
echo.
echo 本脚本用于验证方案1的优化效果
echo.
echo 优化内容：
echo   - 添加节点级别标志位 logLimitReached
echo   - 避免重复打印7000+条警告日志
echo   - 预期性能提升：75%%
echo.
echo ========================================
echo 验证步骤：
echo ========================================
echo.
echo 1. 编译项目
echo    命令: mvn clean compile
echo.
echo 2. 运行测试
echo    - 使用相同的测试数据（10000条日志，9000条属于同一节点）
echo    - 对比优化前后的日志输出
echo.
echo 3. 检查日志文件
echo    优化前: 会看到约7000条重复的WARN日志
echo    优化后: 只会看到1条WARN日志
echo.
echo 4. 对比性能
echo    优化前: 建图耗时约4秒
echo    优化后: 建图耗时约100ms
echo.
echo ========================================
echo 关键日志标识：
echo ========================================
echo.
echo 优化前的日志特征：
echo   [WARN] 【建图-日志累积优化】非告警节点 xxx 的日志数已达上限
echo   [INFO] 【建图-日志累积优化】节点 xxx 合并完成: 新增=0, 跳过=1
echo   ↑ 这两条日志会重复出现7000+次
echo.
echo 优化后的日志特征：
echo   [WARN] 【建图-日志累积优化】非告警节点 xxx 的日志数已达上限
echo   ↑ 这条日志只会出现1次
echo   ↑ 后续不再有重复的INFO日志
echo.
echo ========================================
echo 开始编译...
echo ========================================
echo.

cd /d "%~dp0"

call mvn clean compile -DskipTests

if %errorlevel% equ 0 (
    echo.
    echo ========================================
    echo 编译成功！
    echo ========================================
    echo.
    echo 现在可以运行应用进行测试了
    echo.
    echo 测试方法：
    echo   1. 启动应用
    echo   2. 执行相同的查询（IP: 10.50.86.150）
    echo   3. 观察日志输出
    echo   4. 对比性能差异
    echo.
    echo 预期效果：
    echo   - 建图阶段耗时从 4秒 降到 100ms
    echo   - 不再有7000+条重复日志
    echo   - 总体查询时间从 6.2秒 降到 1.5秒
    echo.
) else (
    echo.
    echo ========================================
    echo 编译失败！请检查错误信息
    echo ========================================
    echo.
)

pause


