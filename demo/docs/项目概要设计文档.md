# è¿›ç¨‹é“¾ç”Ÿæˆç³»ç»Ÿ - é¡¹ç›®æ¦‚è¦è®¾è®¡æ–‡æ¡£

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **æœ€åæ›´æ–°**: 2025-10-28  
> **ç›®æ ‡è¯»è€…**: å‰ç«¯å¼€å‘ã€åç«¯å¼€å‘ã€äº§å“ç»ç†ã€æµ‹è¯•å·¥ç¨‹å¸ˆ

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
3. [APIæ¥å£è®¾è®¡](#3-apiæ¥å£è®¾è®¡)
4. [æ•°æ®ç»“æ„è®¾è®¡](#4-æ•°æ®ç»“æ„è®¾è®¡)
5. [å‰ç«¯å¯¹æ¥æŒ‡å—](#5-å‰ç«¯å¯¹æ¥æŒ‡å—)
6. [å¯è§†åŒ–ç¤ºä¾‹](#6-å¯è§†åŒ–ç¤ºä¾‹)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

è¿›ç¨‹é“¾ç”Ÿæˆç³»ç»Ÿæ˜¯ä¸€ä¸ªä¼ä¸šçº§å®‰å…¨äº‹ä»¶åˆ†æç³»ç»Ÿï¼Œç”¨äºè‡ªåŠ¨æ„å»ºå’Œå¯è§†åŒ–å®‰å…¨å‘Šè­¦çš„è¿›ç¨‹è°ƒç”¨é“¾è·¯ï¼Œå¸®åŠ©å®‰å…¨åˆ†æå¸ˆå¿«é€Ÿå®šä½æ”»å‡»è·¯å¾„å’Œå¨èƒæºå¤´ã€‚

### 1.2 æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | åŠŸèƒ½æè¿° |
|---------|---------|
| **è¿›ç¨‹é“¾æ„å»º** | ä»å‘Šè­¦å’Œæ—¥å¿—è‡ªåŠ¨æ„å»ºå®Œæ•´çš„è¿›ç¨‹æ‰§è¡Œé“¾ |
| **æ–­é“¾å¤„ç†** | è‡ªåŠ¨æ£€æµ‹å¹¶ä¿®å¤æ–­é“¾ï¼ˆåˆ›å»ºEXPLOREè™šæ‹Ÿæ ¹èŠ‚ç‚¹ï¼‰ |
| **æ™ºèƒ½è£å‰ª** | å½“èŠ‚ç‚¹æ•°>1000æ—¶ï¼ŒåŸºäºé‡è¦æ€§è¯„åˆ†æ™ºèƒ½è£å‰ª |
| **ç½‘ç«¯åˆå¹¶** | åˆå¹¶ç½‘ç»œä¾§å’Œç«¯ç‚¹ä¾§çš„è¿›ç¨‹é“¾ï¼Œåˆ›å»ºæ¡¥æ¥è¾¹ |
| **å‘Šè­¦é€‰ä¸¾** | ä»å¤šä¸ªå‘Šè­¦ç»„ä¸­é€‰å‡ºæœ€ä¸¥é‡çš„ç»„ |
| **æ‰©å±•æº¯æº** | å‘ä¸Šè¿½æº¯çˆ¶/ç¥–çˆ¶è¿›ç¨‹ï¼Œè·å¾—æ›´å®Œæ•´çš„æ”»å‡»æºå¤´ |

### 1.3 æŠ€æœ¯æ ˆ

- **åç«¯**: Java 8 + Spring Boot 2.7.18
- **æ•°æ®åº“**: Elasticsearch 7.17.15
- **API**: RESTful API
- **æ•°æ®æ ¼å¼**: JSON

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ€»ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Frontend (å‰ç«¯)                         â”‚
â”‚             - è¿›ç¨‹é“¾å¯è§†åŒ–ï¼ˆå›¾å½¢åŒ–å±•ç¤ºï¼‰                      â”‚
â”‚             - èŠ‚ç‚¹/è¾¹äº¤äº’ï¼ˆç‚¹å‡»ã€æ‚¬åœã€ç¼©æ”¾ï¼‰                 â”‚
â”‚             - å‘Šè­¦ä¿¡æ¯å±•ç¤º                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ HTTP/JSON
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   REST API (Controller)                      â”‚
â”‚           GET  /api/processchain/generate                    â”‚
â”‚           POST /api/processchain/batch-generate              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Service Layer (æœåŠ¡å±‚)                      â”‚
â”‚  - æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ– (MultiSearchRequest)                         â”‚
â”‚  - å‘Šè­¦é€‰ä¸¾ (ç½‘ç«¯ä¼˜å…ˆ/é€‰ä¸¾ç®—æ³•)                               â”‚
â”‚  - è¿›ç¨‹é“¾æ„å»º (åŒå‘/å‘ä¸Šéå†)                                 â”‚
â”‚  - æ™ºèƒ½è£å‰ª (èŠ‚ç‚¹æ•°>1000)                                     â”‚
â”‚  - æ‰©å±•æº¯æº (å‘ä¸Šè¿½æº¯çˆ¶/ç¥–çˆ¶è¿›ç¨‹)                             â”‚
â”‚  - ç½‘ç«¯åˆå¹¶ (åˆ›å»ºæ¡¥æ¥è¾¹)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Elasticsearch                             â”‚
â”‚  - alarm_index (å‘Šè­¦ç´¢å¼•)                                    â”‚
â”‚  - log_index (æ—¥å¿—ç´¢å¼•)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ•°æ®æµç¨‹

```
è¾“å…¥: IPåˆ—è¡¨
   â†“
æ‰¹é‡æŸ¥è¯¢å‘Šè­¦ (ES MultiSearch)
   â†“
å‘Šè­¦é€‰ä¸¾ (é€‰å‡ºæœ€ä¸¥é‡çš„å‘Šè­¦ç»„)
   â†“
æ‰¹é‡æŸ¥è¯¢æ—¥å¿— (ES MultiSearch)
   â†“
æ„å»ºç«¯ä¾§è¿›ç¨‹é“¾
   â”œâ”€ é«˜å±å‘Šè­¦: åŒå‘éå† (å‘ä¸Š+å‘ä¸‹)
   â””â”€ ä¸­ä½å±å‘Šè­¦: å‘ä¸Šéå†
   â†“
æ–­é“¾æ£€æµ‹ (æ— æ³•è¿½æº¯åˆ°æ ¹èŠ‚ç‚¹)
   â””â”€ åˆ›å»º EXPLORE è™šæ‹Ÿæ ¹èŠ‚ç‚¹
   â†“
æ™ºèƒ½è£å‰ª (èŠ‚ç‚¹æ•° > 1000)
   â””â”€ ä¿ç•™å…³é”®èŠ‚ç‚¹å’Œè·¯å¾„
   â†“
æ‰©å±•æº¯æº (å¯é€‰)
   â””â”€ å‘ä¸Šè¿½æº¯çˆ¶/ç¥–çˆ¶è¿›ç¨‹
   â†“
åˆå¹¶ç½‘ä¾§ç«¯ä¾§
   â””â”€ åˆ›å»ºæ¡¥æ¥è¾¹ (victim â†’ root)
   â†“
è¾“å‡º: IncidentProcessChain (JSON)
```

---

## 3. APIæ¥å£è®¾è®¡

### 3.1 å•ä¸ªIPç”Ÿæˆè¿›ç¨‹é“¾

**æ¥å£åœ°å€**: `GET /api/processchain/generate`

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|------|------|------|
| ip | String | æ˜¯ | ç›®æ ‡IPåœ°å€ | 192.168.1.100 |
| associatedEventId | String | å¦ | ç½‘ç«¯å…³è”äº‹ä»¶ID | event_001 |

**è¯·æ±‚ç¤ºä¾‹**:
```bash
GET /api/processchain/generate?ip=192.168.1.100&associatedEventId=event_001
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "traceIds": ["trace123", "trace456"],
  "hostAddresses": ["192.168.1.100"],
  "threatSeverity": "HIGH",
  "nodes": [
    {
      "nodeId": "guid_root_001",
      "logType": "PROCESS",
      "nodeThreatSeverity": "HIGH",
      "isChainNode": true,
      "chainNode": {
        "isRoot": true,
        "isBroken": false,
        "isAlarm": false,
        "isExtensionNode": false,
        "extensionDepth": 0,
        "processEntity": {
          "processGuid": "guid_root_001",
          "parentProcessGuid": null,
          "processName": "explorer.exe",
          "commandline": "C:\\Windows\\explorer.exe",
          "processUserName": "SYSTEM",
          "localtime": "2025-10-28 10:00:00"
        }
      }
    },
    {
      "nodeId": "guid_alarm_001",
      "logType": "PROCESS",
      "nodeThreatSeverity": "HIGH",
      "isChainNode": true,
      "chainNode": {
        "isRoot": false,
        "isBroken": false,
        "isAlarm": true,
        "isExtensionNode": false,
        "alarmNodeInfo": {
          "alarmName": "æ¶æ„è¿›ç¨‹æ‰§è¡Œ",
          "threatSeverity": "HIGH",
          "alarmDescription": "æ£€æµ‹åˆ°å¯ç–‘çš„è¿›ç¨‹æ‰§è¡Œè¡Œä¸º",
          "dvcAction": "blocked",
          "alarmSource": "EDR"
        },
        "processEntity": {
          "processGuid": "guid_alarm_001",
          "parentProcessGuid": "guid_root_001",
          "processName": "powershell.exe",
          "commandline": "powershell.exe -enc base64_command",
          "processUserName": "Administrator",
          "localtime": "2025-10-28 10:05:00"
        }
      }
    }
  ],
  "edges": [
    {
      "source": "guid_root_001",
      "target": "guid_alarm_001",
      "val": "åˆ›å»ºè¿›ç¨‹"
    }
  ]
}
```

### 3.2 æ‰¹é‡ç”Ÿæˆè¿›ç¨‹é“¾

**æ¥å£åœ°å€**: `POST /api/processchain/batch-generate`

**è¯·æ±‚ä½“**:
```json
{
  "ips": ["192.168.1.100", "192.168.1.101"],
  "associatedEventIds": {
    "192.168.1.100": "event_001"
  }
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "192.168.1.100": {
    "traceIds": ["trace123"],
    "hostAddresses": ["192.168.1.100"],
    "threatSeverity": "HIGH",
    "nodes": [...],
    "edges": [...]
  },
  "192.168.1.101": {
    "traceIds": ["trace456"],
    "hostAddresses": ["192.168.1.101"],
    "threatSeverity": "MEDIUM",
    "nodes": [...],
    "edges": [...]
  }
}
```

---

## 4. æ•°æ®ç»“æ„è®¾è®¡

### 4.1 IncidentProcessChainï¼ˆä¸»æ•°æ®ç»“æ„ï¼‰â­

**ç”¨é€”**: è¿”å›ç»™å‰ç«¯çš„å®Œæ•´è¿›ç¨‹é“¾æ•°æ®ç»“æ„

**å­—æ®µè¯´æ˜**:

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|------|------|
| traceIds | List&lt;String&gt; | æº¯æºIDåˆ—è¡¨ï¼Œæ”¯æŒå¤šä¸ªtraceId | ["trace123", "trace456"] |
| hostAddresses | List&lt;String&gt; | ä¸»æœºåœ°å€åˆ—è¡¨ï¼Œæ”¯æŒå¤šä¸ªIP | ["192.168.1.100", "192.168.1.101"] |
| threatSeverity | ThreatSeverity | æ•´ä½“å¨èƒç­‰çº§ | HIGH / MEDIUM / LOW |
| nodes | List&lt;ProcessNode&gt; | èŠ‚ç‚¹åˆ—è¡¨ | è§ä¸‹æ–‡ |
| edges | List&lt;ProcessEdge&gt; | è¾¹åˆ—è¡¨ | è§ä¸‹æ–‡ |

**TypeScriptæ¥å£å®šä¹‰**:
```typescript
interface IncidentProcessChain {
  traceIds: string[];          // æº¯æºIDåˆ—è¡¨
  hostAddresses: string[];     // ä¸»æœºåœ°å€åˆ—è¡¨
  threatSeverity: ThreatSeverity;  // å¨èƒç­‰çº§
  nodes: ProcessNode[];        // èŠ‚ç‚¹åˆ—è¡¨
  edges: ProcessEdge[];        // è¾¹åˆ—è¡¨
}

enum ThreatSeverity {
  HIGH = "HIGH",       // é«˜å±
  MEDIUM = "MEDIUM",   // ä¸­å±
  LOW = "LOW",         // ä½å±
  UNKNOWN = "UNKNOWN"  // æœªçŸ¥
}
```

---

### 4.2 ProcessNodeï¼ˆèŠ‚ç‚¹æ•°æ®ç»“æ„ï¼‰â­

**ç”¨é€”**: è¡¨ç¤ºè¿›ç¨‹é“¾ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆè¿›ç¨‹/æ–‡ä»¶/ç½‘ç»œ/åŸŸåç­‰ï¼‰

**å­—æ®µè¯´æ˜**:

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|------|------|
| nodeId | String | èŠ‚ç‚¹å”¯ä¸€IDï¼ˆè¿›ç¨‹GUIDï¼‰ | "guid_001" |
| logType | NodeType | èŠ‚ç‚¹ç±»å‹ | PROCESS / FILE / NETWORK / DOMAIN |
| nodeThreatSeverity | ThreatSeverity | èŠ‚ç‚¹å¨èƒç­‰çº§ | HIGH / MEDIUM / LOW |
| isChainNode | Boolean | æ˜¯å¦æ˜¯è¿›ç¨‹é“¾èŠ‚ç‚¹ï¼ˆtrue=ç«¯ä¾§ï¼Œfalse=ç½‘ä¾§ï¼‰ | true |
| chainNode | ChainNode | è¿›ç¨‹é“¾èŠ‚ç‚¹è¯¦æƒ…ï¼ˆisChainNode=trueæ—¶æœ‰å€¼ï¼‰ | è§ä¸‹æ–‡ |
| storyNode | StoryNode | æ•…äº‹çº¿èŠ‚ç‚¹è¯¦æƒ…ï¼ˆisChainNode=falseæ—¶æœ‰å€¼ï¼‰ | è§ä¸‹æ–‡ |

**TypeScriptæ¥å£å®šä¹‰**:
```typescript
interface ProcessNode {
  nodeId: string;                    // èŠ‚ç‚¹ID
  logType: NodeType;                 // èŠ‚ç‚¹ç±»å‹
  nodeThreatSeverity: ThreatSeverity;  // å¨èƒç­‰çº§
  isChainNode: boolean;              // æ˜¯å¦æ˜¯è¿›ç¨‹é“¾èŠ‚ç‚¹
  chainNode?: ChainNode;             // è¿›ç¨‹é“¾èŠ‚ç‚¹è¯¦æƒ…
  storyNode?: StoryNode;             // æ•…äº‹çº¿èŠ‚ç‚¹è¯¦æƒ…
}

enum NodeType {
  PROCESS = "PROCESS",     // è¿›ç¨‹èŠ‚ç‚¹
  FILE = "FILE",           // æ–‡ä»¶èŠ‚ç‚¹
  NETWORK = "NETWORK",     // ç½‘ç»œèŠ‚ç‚¹
  DOMAIN = "DOMAIN",       // åŸŸåèŠ‚ç‚¹
  REGISTRY = "REGISTRY",   // æ³¨å†Œè¡¨èŠ‚ç‚¹
  EXPLORE = "EXPLORE",     // æ¢ç´¢èŠ‚ç‚¹ï¼ˆæ–­é“¾å ä½ï¼‰
  UNKNOWN = "UNKNOWN"      // æœªçŸ¥ç±»å‹
}
```

---

### 4.3 ChainNodeï¼ˆè¿›ç¨‹é“¾èŠ‚ç‚¹è¯¦æƒ…ï¼‰â­

**ç”¨é€”**: è¿›ç¨‹é“¾èŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯ï¼ˆç«¯ä¾§èŠ‚ç‚¹ï¼‰

**å­—æ®µè¯´æ˜**:

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | å‰ç«¯ä½¿ç”¨å»ºè®® |
|-------|------|------|-------------|
| isRoot | Boolean | æ˜¯å¦æ˜¯æ ¹èŠ‚ç‚¹ | æ ¹èŠ‚ç‚¹æ˜¾ç¤ºç‰¹æ®Šå›¾æ ‡/é¢œè‰² |
| isBroken | Boolean | æ˜¯å¦æ˜¯æ–­é“¾èŠ‚ç‚¹ | æ–­é“¾èŠ‚ç‚¹æ˜¾ç¤ºè™šçº¿è¾¹æ¡† |
| isAlarm | Boolean | æ˜¯å¦æ˜¯å‘Šè­¦èŠ‚ç‚¹ | å‘Šè­¦èŠ‚ç‚¹é«˜äº®æ˜¾ç¤º |
| isExtensionNode | Boolean | æ˜¯å¦æ˜¯æ‰©å±•èŠ‚ç‚¹ | æ‰©å±•èŠ‚ç‚¹ä½¿ç”¨ä¸åŒé¢œè‰² |
| extensionDepth | Integer | æ‰©å±•æ·±åº¦ï¼ˆ0=åŸæ ¹ï¼Œ1=çˆ¶ï¼Œ2=ç¥–çˆ¶ï¼‰ | ç”¨äºåŒºåˆ†æ‰©å±•å±‚çº§ |
| alarmNodeInfo | AlarmNodeInfo | å‘Šè­¦ä¿¡æ¯ï¼ˆisAlarm=trueæ—¶æœ‰å€¼ï¼‰ | æ˜¾ç¤ºå‘Šè­¦è¯¦æƒ… |
| processEntity | ProcessEntity | è¿›ç¨‹å®ä½“ä¿¡æ¯ | æ˜¾ç¤ºè¿›ç¨‹è¯¦æƒ… |
| entity | Object | å…¶ä»–å®ä½“ï¼ˆæ–‡ä»¶/ç½‘ç»œ/åŸŸåï¼‰ | æ ¹æ®logTypeè§£æ |

**TypeScriptæ¥å£å®šä¹‰**:
```typescript
interface ChainNode {
  isRoot: boolean;               // æ˜¯å¦æ˜¯æ ¹èŠ‚ç‚¹
  isBroken: boolean;             // æ˜¯å¦æ˜¯æ–­é“¾èŠ‚ç‚¹
  isAlarm: boolean;              // æ˜¯å¦æ˜¯å‘Šè­¦èŠ‚ç‚¹
  isExtensionNode: boolean;      // æ˜¯å¦æ˜¯æ‰©å±•èŠ‚ç‚¹
  extensionDepth: number;        // æ‰©å±•æ·±åº¦
  alarmNodeInfo?: AlarmNodeInfo; // å‘Šè­¦ä¿¡æ¯
  processEntity?: ProcessEntity; // è¿›ç¨‹å®ä½“
  entity?: any;                  // å…¶ä»–å®ä½“
}
```

**èŠ‚ç‚¹çŠ¶æ€ç»„åˆç¤ºä¾‹**:

| åœºæ™¯ | isRoot | isBroken | isAlarm | isExtensionNode | å‰ç«¯å±•ç¤ºå»ºè®® |
|------|--------|----------|---------|-----------------|-------------|
| æ­£å¸¸æ ¹èŠ‚ç‚¹ | true | false | false | false | ğŸŸ¢ ç»¿è‰²æ ¹èŠ‚ç‚¹å›¾æ ‡ |
| æ–­é“¾æ ¹èŠ‚ç‚¹ | false | true | false | false | ğŸ”´ çº¢è‰²è™šçº¿è¾¹æ¡† + "æ–­é“¾"æ ‡ç­¾ |
| å‘Šè­¦èŠ‚ç‚¹ | false | false | true | false | âš ï¸ é»„/çº¢è‰²é«˜äº® + å‘Šè­¦å›¾æ ‡ |
| æ‰©å±•æ ¹èŠ‚ç‚¹ | true | false | false | true | ğŸ”µ è“è‰² + "æ‰©å±•"æ ‡ç­¾ |
| æ™®é€šèŠ‚ç‚¹ | false | false | false | false | âšª é»˜è®¤æ ·å¼ |

---

### 4.4 ProcessEntityï¼ˆè¿›ç¨‹å®ä½“ä¿¡æ¯ï¼‰

**ç”¨é€”**: è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯

**å­—æ®µè¯´æ˜**:

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|------|------|
| processGuid | String | è¿›ç¨‹GUIDï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰ | "guid_001" |
| parentProcessGuid | String | çˆ¶è¿›ç¨‹GUID | "guid_parent" |
| processName | String | è¿›ç¨‹åç§° | "powershell.exe" |
| processId | String | è¿›ç¨‹PID | "1234" |
| image | String | è¿›ç¨‹é•œåƒè·¯å¾„ | "C:\\Windows\\System32\\..." |
| commandline | String | å‘½ä»¤è¡Œ | "powershell.exe -enc ..." |
| processUserName | String | æ‰§è¡Œç”¨æˆ· | "Administrator" |
| localtime | String | æ‰§è¡Œæ—¶é—´ | "2025-10-28 10:05:00" |
| opType | String | æ“ä½œç±»å‹ | "create" / "terminate" |

**TypeScriptæ¥å£å®šä¹‰**:
```typescript
interface ProcessEntity {
  processGuid: string;        // è¿›ç¨‹GUID
  parentProcessGuid: string;  // çˆ¶è¿›ç¨‹GUID
  processName: string;        // è¿›ç¨‹åç§°
  processId: string;          // è¿›ç¨‹PID
  image: string;              // è¿›ç¨‹é•œåƒè·¯å¾„
  commandline: string;        // å‘½ä»¤è¡Œ
  processUserName: string;    // æ‰§è¡Œç”¨æˆ·
  localtime: string;          // æ‰§è¡Œæ—¶é—´
  opType: string;             // æ“ä½œç±»å‹
}
```

---

### 4.5 AlarmNodeInfoï¼ˆå‘Šè­¦ä¿¡æ¯ï¼‰

**ç”¨é€”**: å‘Šè­¦èŠ‚ç‚¹çš„å‘Šè­¦è¯¦æƒ…

**å­—æ®µè¯´æ˜**:

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|------|------|
| alarmName | String | å‘Šè­¦åç§° | "æ¶æ„è¿›ç¨‹æ‰§è¡Œ" |
| threatSeverity | ThreatSeverity | å¨èƒç­‰çº§ | HIGH / MEDIUM / LOW |
| alarmDescription | String | å‘Šè­¦æè¿° | "æ£€æµ‹åˆ°å¯ç–‘çš„è¿›ç¨‹æ‰§è¡Œè¡Œä¸º" |
| dvcAction | String | è®¾å¤‡åŠ¨ä½œ | "blocked" / "allowed" |
| alarmSource | String | å‘Šè­¦æ¥æº | "EDR" / "AV" |
| alarmResults | String | å‘Šè­¦ç»“æœ | "å¤„ç½®æˆåŠŸ" |

**TypeScriptæ¥å£å®šä¹‰**:
```typescript
interface AlarmNodeInfo {
  alarmName: string;           // å‘Šè­¦åç§°
  threatSeverity: ThreatSeverity;  // å¨èƒç­‰çº§
  alarmDescription: string;    // å‘Šè­¦æè¿°
  dvcAction: string;           // è®¾å¤‡åŠ¨ä½œ
  alarmSource: string;         // å‘Šè­¦æ¥æº
  alarmResults: string;        // å‘Šè­¦ç»“æœ
}
```

---

### 4.6 ProcessEdgeï¼ˆè¾¹æ•°æ®ç»“æ„ï¼‰â­

**ç”¨é€”**: è¡¨ç¤ºèŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»

**å­—æ®µè¯´æ˜**:

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|------|------|
| source | String | æºèŠ‚ç‚¹IDï¼ˆçˆ¶èŠ‚ç‚¹ï¼‰ | "guid_parent" |
| target | String | ç›®æ ‡èŠ‚ç‚¹IDï¼ˆå­èŠ‚ç‚¹ï¼‰ | "guid_child" |
| val | String | è¾¹çš„æè¿°/æ ‡ç­¾ | "åˆ›å»ºè¿›ç¨‹" / "æ¡¥æ¥" / "æ‰©å±•" |

**TypeScriptæ¥å£å®šä¹‰**:
```typescript
interface ProcessEdge {
  source: string;  // æºèŠ‚ç‚¹IDï¼ˆçˆ¶èŠ‚ç‚¹ï¼‰
  target: string;  // ç›®æ ‡èŠ‚ç‚¹IDï¼ˆå­èŠ‚ç‚¹ï¼‰
  val: string;     // è¾¹çš„æè¿°
}
```

**å¸¸è§è¾¹ç±»å‹**:

| valå€¼ | è¯´æ˜ | å‰ç«¯å±•ç¤ºå»ºè®® |
|-------|------|-------------|
| "åˆ›å»ºè¿›ç¨‹" | æ­£å¸¸çš„çˆ¶å­è¿›ç¨‹å…³ç³» | å®çº¿ç®­å¤´ |
| "æ¡¥æ¥" | ç½‘ä¾§åˆ°ç«¯ä¾§çš„æ¡¥æ¥è¾¹ | è™šçº¿ç®­å¤´ + "æ¡¥æ¥"æ ‡ç­¾ |
| "æ‰©å±•" | æ‰©å±•æº¯æºçš„è¾¹ | è“è‰²å®çº¿ + "æ‰©å±•"æ ‡ç­¾ |

---

### 4.7 StoryNodeï¼ˆæ•…äº‹çº¿èŠ‚ç‚¹ï¼‰

**ç”¨é€”**: ç½‘ç»œä¾§çš„æ•…äº‹çº¿èŠ‚ç‚¹ï¼ˆæ”»å‡»è€…ã€å—å®³è€…ã€å·¥å…·ç­‰ï¼‰

**å­—æ®µè¯´æ˜**:

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|------|------|
| type | String | èŠ‚ç‚¹ç±»å‹ | "victim" / "attacker" / "tool" |
| other | Map&lt;String, Object&gt; | å…¶ä»–ä¿¡æ¯ | {"ip": "192.168.1.100", "name": "WebæœåŠ¡å™¨"} |

**TypeScriptæ¥å£å®šä¹‰**:
```typescript
interface StoryNode {
  type: string;                    // èŠ‚ç‚¹ç±»å‹
  other: Record<string, any>;      // å…¶ä»–ä¿¡æ¯
}
```

---

## 5. å‰ç«¯å¯¹æ¥æŒ‡å—

### 5.1 æ•°æ®è·å–æµç¨‹

```typescript
// 1. è°ƒç”¨APIè·å–è¿›ç¨‹é“¾æ•°æ®
async function fetchProcessChain(ip: string, associatedEventId?: string) {
  const url = `/api/processchain/generate?ip=${ip}` + 
    (associatedEventId ? `&associatedEventId=${associatedEventId}` : '');
  
  const response = await fetch(url);
  const data: IncidentProcessChain = await response.json();
  
  return data;
}

// 2. ä½¿ç”¨ç¤ºä¾‹
const chain = await fetchProcessChain('192.168.1.100', 'event_001');
console.log('èŠ‚ç‚¹æ•°é‡:', chain.nodes.length);
console.log('è¾¹æ•°é‡:', chain.edges.length);
console.log('å¨èƒç­‰çº§:', chain.threatSeverity);
```

### 5.2 èŠ‚ç‚¹æ¸²æŸ“å»ºè®®

```typescript
function renderNode(node: ProcessNode) {
  // åˆ¤æ–­èŠ‚ç‚¹ç±»å‹
  if (node.isChainNode && node.chainNode) {
    const chain = node.chainNode;
    
    // 1ï¸âƒ£ æ ¹èŠ‚ç‚¹ - ç‰¹æ®Šæ ‡è¯†
    if (chain.isRoot) {
      return {
        icon: 'ğŸŒŸ',
        color: '#52c41a',  // ç»¿è‰²
        label: chain.isExtensionNode ? 'æ‰©å±•æ ¹èŠ‚ç‚¹' : 'æ ¹èŠ‚ç‚¹',
        borderStyle: 'solid'
      };
    }
    
    // 2ï¸âƒ£ æ–­é“¾èŠ‚ç‚¹ - è™šçº¿è¾¹æ¡†
    if (chain.isBroken) {
      return {
        icon: 'âš ï¸',
        color: '#f5222d',  // çº¢è‰²
        label: 'æ–­é“¾èŠ‚ç‚¹',
        borderStyle: 'dashed'
      };
    }
    
    // 3ï¸âƒ£ å‘Šè­¦èŠ‚ç‚¹ - é«˜äº®æ˜¾ç¤º
    if (chain.isAlarm && chain.alarmNodeInfo) {
      const severity = chain.alarmNodeInfo.threatSeverity;
      return {
        icon: 'ğŸš¨',
        color: severity === 'HIGH' ? '#f5222d' : 
               severity === 'MEDIUM' ? '#fa8c16' : '#faad14',
        label: chain.alarmNodeInfo.alarmName,
        borderWidth: 3  // åŠ ç²—è¾¹æ¡†
      };
    }
    
    // 4ï¸âƒ£ æ‰©å±•èŠ‚ç‚¹ - ç‰¹æ®Šé¢œè‰²
    if (chain.isExtensionNode) {
      return {
        icon: 'ğŸ”',
        color: '#1890ff',  // è“è‰²
        label: `æ‰©å±•èŠ‚ç‚¹(æ·±åº¦${chain.extensionDepth})`,
        borderStyle: 'solid'
      };
    }
    
    // 5ï¸âƒ£ æ™®é€šèŠ‚ç‚¹
    return {
      icon: getIconByLogType(node.logType),
      color: '#d9d9d9',  // ç°è‰²
      label: chain.processEntity?.processName || node.nodeId,
      borderStyle: 'solid'
    };
  } else if (node.storyNode) {
    // ç½‘ä¾§æ•…äº‹çº¿èŠ‚ç‚¹
    return {
      icon: getStoryNodeIcon(node.storyNode.type),
      color: '#722ed1',  // ç´«è‰²
      label: node.storyNode.type,
      shape: 'diamond'  // è±å½¢
    };
  }
}

function getIconByLogType(logType: NodeType): string {
  const icons = {
    PROCESS: 'âš™ï¸',
    FILE: 'ğŸ“„',
    NETWORK: 'ğŸŒ',
    DOMAIN: 'ğŸ”—',
    REGISTRY: 'ğŸ“',
    EXPLORE: 'ğŸ”',
    UNKNOWN: 'â“'
  };
  return icons[logType] || 'â“';
}
```

### 5.3 è¾¹æ¸²æŸ“å»ºè®®

```typescript
function renderEdge(edge: ProcessEdge) {
  // æ ¹æ®è¾¹çš„æè¿°é€‰æ‹©æ ·å¼
  if (edge.val === 'æ¡¥æ¥') {
    return {
      lineStyle: 'dashed',  // è™šçº¿
      color: '#722ed1',     // ç´«è‰²
      label: 'æ¡¥æ¥',
      width: 2
    };
  }
  
  if (edge.val === 'æ‰©å±•') {
    return {
      lineStyle: 'solid',   // å®çº¿
      color: '#1890ff',     // è“è‰²
      label: 'æ‰©å±•',
      width: 2
    };
  }
  
  // é»˜è®¤è¾¹ï¼ˆçˆ¶å­è¿›ç¨‹å…³ç³»ï¼‰
  return {
    lineStyle: 'solid',
    color: '#8c8c8c',      // ç°è‰²
    label: edge.val || '',
    width: 1
  };
}
```

### 5.4 èŠ‚ç‚¹è¯¦æƒ…å±•ç¤º

```typescript
function showNodeDetail(node: ProcessNode) {
  if (!node.isChainNode || !node.chainNode) return;
  
  const chain = node.chainNode;
  const details = [];
  
  // åŸºç¡€ä¿¡æ¯
  details.push({
    label: 'èŠ‚ç‚¹ID',
    value: node.nodeId
  });
  
  details.push({
    label: 'èŠ‚ç‚¹ç±»å‹',
    value: node.logType
  });
  
  details.push({
    label: 'å¨èƒç­‰çº§',
    value: node.nodeThreatSeverity,
    color: getThreatColor(node.nodeThreatSeverity)
  });
  
  // èŠ‚ç‚¹çŠ¶æ€
  const statuses = [];
  if (chain.isRoot) statuses.push('æ ¹èŠ‚ç‚¹');
  if (chain.isBroken) statuses.push('æ–­é“¾èŠ‚ç‚¹');
  if (chain.isAlarm) statuses.push('å‘Šè­¦èŠ‚ç‚¹');
  if (chain.isExtensionNode) statuses.push(`æ‰©å±•èŠ‚ç‚¹(æ·±åº¦${chain.extensionDepth})`);
  
  if (statuses.length > 0) {
    details.push({
      label: 'èŠ‚ç‚¹çŠ¶æ€',
      value: statuses.join(' | ')
    });
  }
  
  // å‘Šè­¦ä¿¡æ¯
  if (chain.isAlarm && chain.alarmNodeInfo) {
    const alarm = chain.alarmNodeInfo;
    details.push({
      label: 'å‘Šè­¦åç§°',
      value: alarm.alarmName
    });
    details.push({
      label: 'å‘Šè­¦æè¿°',
      value: alarm.alarmDescription
    });
    details.push({
      label: 'è®¾å¤‡åŠ¨ä½œ',
      value: alarm.dvcAction
    });
    details.push({
      label: 'å‘Šè­¦æ¥æº',
      value: alarm.alarmSource
    });
  }
  
  // è¿›ç¨‹ä¿¡æ¯
  if (chain.processEntity) {
    const proc = chain.processEntity;
    details.push({
      label: 'è¿›ç¨‹åç§°',
      value: proc.processName
    });
    details.push({
      label: 'è¿›ç¨‹ID',
      value: proc.processId
    });
    details.push({
      label: 'å‘½ä»¤è¡Œ',
      value: proc.commandline
    });
    details.push({
      label: 'æ‰§è¡Œç”¨æˆ·',
      value: proc.processUserName
    });
    details.push({
      label: 'æ‰§è¡Œæ—¶é—´',
      value: proc.localtime
    });
    details.push({
      label: 'é•œåƒè·¯å¾„',
      value: proc.image
    });
  }
  
  return details;
}
```

### 5.5 å›¾å½¢å¸ƒå±€å»ºè®®

```typescript
// æ¨èä½¿ç”¨åˆ†å±‚å¸ƒå±€ï¼ˆHierarchical Layoutï¼‰
const layoutOptions = {
  layout: 'hierarchical',
  hierarchical: {
    direction: 'UD',        // ä»ä¸Šåˆ°ä¸‹ (Up-Down)
    sortMethod: 'directed', // æœ‰å‘å›¾æ’åº
    levelSeparation: 150,   // å±‚çº§é—´è·
    nodeSpacing: 100,       // èŠ‚ç‚¹é—´è·
    treeSpacing: 200        // æ ‘é—´è·
  }
};

// æ¨èçš„å¯è§†åŒ–åº“
// - G6 (AntV): https://g6.antv.vision/
// - Cytoscape.js: https://js.cytoscape.org/
// - D3.js: https://d3js.org/
// - vis-network: https://visjs.org/
```

---

## 6. å¯è§†åŒ–ç¤ºä¾‹

### 6.1 ç®€å•è¿›ç¨‹é“¾ç¤ºä¾‹

**åœºæ™¯**: ä¸€ä¸ªé«˜å±å‘Šè­¦çš„å®Œæ•´è¿›ç¨‹é“¾

```json
{
  "traceIds": ["trace123"],
  "hostAddresses": ["192.168.1.100"],
  "threatSeverity": "HIGH",
  "nodes": [
    {
      "nodeId": "guid_root",
      "logType": "PROCESS",
      "nodeThreatSeverity": "LOW",
      "isChainNode": true,
      "chainNode": {
        "isRoot": true,
        "isBroken": false,
        "isAlarm": false,
        "processEntity": {
          "processName": "explorer.exe",
          "processGuid": "guid_root",
          "parentProcessGuid": null,
          "commandline": "C:\\Windows\\explorer.exe",
          "processUserName": "User",
          "localtime": "2025-10-28 09:00:00"
        }
      }
    },
    {
      "nodeId": "guid_cmd",
      "logType": "PROCESS",
      "nodeThreatSeverity": "MEDIUM",
      "isChainNode": true,
      "chainNode": {
        "isRoot": false,
        "isBroken": false,
        "isAlarm": false,
        "processEntity": {
          "processName": "cmd.exe",
          "processGuid": "guid_cmd",
          "parentProcessGuid": "guid_root",
          "commandline": "cmd.exe /c whoami",
          "processUserName": "User",
          "localtime": "2025-10-28 10:00:00"
        }
      }
    },
    {
      "nodeId": "guid_powershell",
      "logType": "PROCESS",
      "nodeThreatSeverity": "HIGH",
      "isChainNode": true,
      "chainNode": {
        "isRoot": false,
        "isBroken": false,
        "isAlarm": true,
        "alarmNodeInfo": {
          "alarmName": "æ¶æ„PowerShellæ‰§è¡Œ",
          "threatSeverity": "HIGH",
          "alarmDescription": "æ£€æµ‹åˆ°å¯ç–‘çš„PowerShellç¼–ç å‘½ä»¤",
          "dvcAction": "blocked",
          "alarmSource": "EDR"
        },
        "processEntity": {
          "processName": "powershell.exe",
          "processGuid": "guid_powershell",
          "parentProcessGuid": "guid_cmd",
          "commandline": "powershell.exe -enc SGVsbG9Xb3JsZA==",
          "processUserName": "User",
          "localtime": "2025-10-28 10:05:00"
        }
      }
    }
  ],
  "edges": [
    {
      "source": "guid_root",
      "target": "guid_cmd",
      "val": "åˆ›å»ºè¿›ç¨‹"
    },
    {
      "source": "guid_cmd",
      "target": "guid_powershell",
      "val": "åˆ›å»ºè¿›ç¨‹"
    }
  ]
}
```

**å¯è§†åŒ–æ•ˆæœ**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŒŸ explorer.exe â”‚  â† æ ¹èŠ‚ç‚¹ï¼ˆç»¿è‰²ï¼‰
â”‚   (guid_root)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ åˆ›å»ºè¿›ç¨‹
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš™ï¸ cmd.exe     â”‚  â† æ™®é€šèŠ‚ç‚¹ï¼ˆç°è‰²ï¼‰
â”‚   (guid_cmd)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ åˆ›å»ºè¿›ç¨‹
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ğŸš¨ powershell.exeâ”‚  â† å‘Šè­¦èŠ‚ç‚¹ï¼ˆçº¢è‰²é«˜äº®ï¼‰
â”‚(guid_powershell)â”‚
â”‚  [HIGH] æ¶æ„    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 æ–­é“¾åœºæ™¯ç¤ºä¾‹

**åœºæ™¯**: æ— æ³•è¿½æº¯åˆ°æ ¹èŠ‚ç‚¹ï¼Œåˆ›å»ºEXPLOREè™šæ‹Ÿæ ¹

```json
{
  "traceIds": ["trace123"],
  "hostAddresses": ["192.168.1.100"],
  "threatSeverity": "HIGH",
  "nodes": [
    {
      "nodeId": "EXPLORE_ROOT_trace123",
      "logType": "EXPLORE",
      "nodeThreatSeverity": "UNKNOWN",
      "isChainNode": true,
      "chainNode": {
        "isRoot": true,
        "isBroken": false,
        "isAlarm": false,
        "processEntity": null
      }
    },
    {
      "nodeId": "guid_broken",
      "logType": "PROCESS",
      "nodeThreatSeverity": "MEDIUM",
      "isChainNode": true,
      "chainNode": {
        "isRoot": false,
        "isBroken": true,
        "isAlarm": false,
        "processEntity": {
          "processName": "svchost.exe",
          "processGuid": "guid_broken",
          "parentProcessGuid": "guid_missing",
          "commandline": "svchost.exe",
          "processUserName": "SYSTEM",
          "localtime": "2025-10-28 10:00:00"
        }
      }
    },
    {
      "nodeId": "guid_alarm",
      "logType": "PROCESS",
      "nodeThreatSeverity": "HIGH",
      "isChainNode": true,
      "chainNode": {
        "isRoot": false,
        "isBroken": false,
        "isAlarm": true,
        "alarmNodeInfo": {
          "alarmName": "å¯ç–‘è¡Œä¸º",
          "threatSeverity": "HIGH",
          "alarmDescription": "æ£€æµ‹åˆ°å¼‚å¸¸è¡Œä¸º",
          "dvcAction": "allowed",
          "alarmSource": "EDR"
        },
        "processEntity": {
          "processName": "malware.exe",
          "processGuid": "guid_alarm",
          "parentProcessGuid": "guid_broken",
          "commandline": "malware.exe",
          "processUserName": "User",
          "localtime": "2025-10-28 10:05:00"
        }
      }
    }
  ],
  "edges": [
    {
      "source": "EXPLORE_ROOT_trace123",
      "target": "guid_broken",
      "val": "æ¢ç´¢"
    },
    {
      "source": "guid_broken",
      "target": "guid_alarm",
      "val": "åˆ›å»ºè¿›ç¨‹"
    }
  ]
}
```

**å¯è§†åŒ–æ•ˆæœ**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” EXPLORE_ROOT    â”‚  â† è™šæ‹Ÿæ ¹èŠ‚ç‚¹ï¼ˆé»„è‰²ï¼‰
â”‚   (trace123)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ æ¢ç´¢
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚âš ï¸ svchost.exe      â”‚  â† æ–­é“¾èŠ‚ç‚¹ï¼ˆçº¢è‰²è™šçº¿è¾¹æ¡†ï¼‰
â”‚  (guid_broken)     â”‚
â”‚   [æ–­é“¾]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ åˆ›å»ºè¿›ç¨‹
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ğŸš¨ malware.exe      â”‚  â† å‘Šè­¦èŠ‚ç‚¹
â”‚  (guid_alarm)      â”‚
â”‚  [HIGH] å¯ç–‘è¡Œä¸º   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 æ‰©å±•æº¯æºç¤ºä¾‹

**åœºæ™¯**: ä»é€»è¾‘æ ¹å‘ä¸Šæ‰©å±•è¿½æº¯çˆ¶/ç¥–çˆ¶è¿›ç¨‹

```json
{
  "nodes": [
    {
      "nodeId": "guid_grandparent",
      "isChainNode": true,
      "chainNode": {
        "isRoot": true,
        "isExtensionNode": true,
        "extensionDepth": 2,
        "processEntity": {
          "processName": "services.exe",
          "processGuid": "guid_grandparent",
          "parentProcessGuid": null
        }
      }
    },
    {
      "nodeId": "guid_parent",
      "isChainNode": true,
      "chainNode": {
        "isRoot": false,
        "isExtensionNode": true,
        "extensionDepth": 1,
        "processEntity": {
          "processName": "svchost.exe",
          "processGuid": "guid_parent",
          "parentProcessGuid": "guid_grandparent"
        }
      }
    },
    {
      "nodeId": "guid_logical_root",
      "isChainNode": true,
      "chainNode": {
        "isRoot": false,
        "isExtensionNode": false,
        "extensionDepth": 0,
        "processEntity": {
          "processName": "powershell.exe",
          "processGuid": "guid_logical_root",
          "parentProcessGuid": "guid_parent"
        }
      }
    }
  ],
  "edges": [
    {
      "source": "guid_grandparent",
      "target": "guid_parent",
      "val": "æ‰©å±•"
    },
    {
      "source": "guid_parent",
      "target": "guid_logical_root",
      "val": "æ‰©å±•"
    }
  ]
}
```

**å¯è§†åŒ–æ•ˆæœ**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ğŸŒŸ services.exe       â”‚  â† æ‰©å±•æ ¹èŠ‚ç‚¹ï¼ˆè“è‰²ï¼‰
â”‚ (guid_grandparent)   â”‚
â”‚ [æ‰©å±•æ·±åº¦2 - ç¥–çˆ¶]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ æ‰©å±•ï¼ˆè“è‰²å®çº¿ï¼‰
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ğŸ” svchost.exe        â”‚  â† æ‰©å±•èŠ‚ç‚¹ï¼ˆè“è‰²ï¼‰
â”‚  (guid_parent)       â”‚
â”‚  [æ‰©å±•æ·±åº¦1 - çˆ¶]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ æ‰©å±•ï¼ˆè“è‰²å®çº¿ï¼‰
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚âš™ï¸ powershell.exe     â”‚  â† åŸé€»è¾‘æ ¹èŠ‚ç‚¹ï¼ˆç°è‰²ï¼‰
â”‚(guid_logical_root)   â”‚
â”‚  [åŸæ ¹èŠ‚ç‚¹]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.4 ç½‘ç«¯åˆå¹¶ç¤ºä¾‹

**åœºæ™¯**: ç½‘ç»œä¾§å’Œç«¯ç‚¹ä¾§åˆå¹¶ï¼ŒåŒ…å«æ¡¥æ¥è¾¹

```json
{
  "nodes": [
    {
      "nodeId": "attacker",
      "logType": "NETWORK",
      "isChainNode": false,
      "storyNode": {
        "type": "attacker",
        "other": {
          "ip": "8.8.8.8",
          "country": "ç¾å›½"
        }
      }
    },
    {
      "nodeId": "victim",
      "logType": "NETWORK",
      "isChainNode": false,
      "storyNode": {
        "type": "victim",
        "other": {
          "ip": "192.168.1.100",
          "hostname": "WEB-SERVER-01"
        }
      }
    },
    {
      "nodeId": "guid_root",
      "isChainNode": true,
      "chainNode": {
        "isRoot": true,
        "processEntity": {
          "processName": "iexplore.exe",
          "processGuid": "guid_root"
        }
      }
    },
    {
      "nodeId": "guid_malware",
      "isChainNode": true,
      "chainNode": {
        "isAlarm": true,
        "alarmNodeInfo": {
          "alarmName": "æ¶æ„ä¸‹è½½",
          "threatSeverity": "HIGH"
        },
        "processEntity": {
          "processName": "malware.exe",
          "processGuid": "guid_malware",
          "parentProcessGuid": "guid_root"
        }
      }
    }
  ],
  "edges": [
    {
      "source": "attacker",
      "target": "victim",
      "val": "æ”»å‡»"
    },
    {
      "source": "victim",
      "target": "guid_root",
      "val": "æ¡¥æ¥"
    },
    {
      "source": "guid_root",
      "target": "guid_malware",
      "val": "åˆ›å»ºè¿›ç¨‹"
    }
  ]
}
```

**å¯è§†åŒ–æ•ˆæœ**:

```
ã€ç½‘ç»œä¾§ã€‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ æ”»å‡»è€…   â”‚ (8.8.8.8)
â”‚ (attacker)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ æ”»å‡»
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¢ å—å®³è€…   â”‚ (192.168.1.100)
â”‚  (victim)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ æ¡¥æ¥ï¼ˆç´«è‰²è™šçº¿ï¼‰
       â–¼
ã€ç«¯ç‚¹ä¾§ã€‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ğŸŒŸiexplore.exeâ”‚ â† æ ¹èŠ‚ç‚¹
â”‚ (guid_root) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ åˆ›å»ºè¿›ç¨‹
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ğŸš¨malware.exeâ”‚ â† å‘Šè­¦èŠ‚ç‚¹
â”‚(guid_malware)â”‚
â”‚[HIGH]æ¶æ„ä¸‹è½½â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. é™„å½•

### 7.1 å®Œæ•´TypeScriptç±»å‹å®šä¹‰

```typescript
// ==================== ä¸»æ•°æ®ç»“æ„ ====================

interface IncidentProcessChain {
  traceIds: string[];
  hostAddresses: string[];
  threatSeverity: ThreatSeverity;
  nodes: ProcessNode[];
  edges: ProcessEdge[];
}

// ==================== èŠ‚ç‚¹ç›¸å…³ ====================

interface ProcessNode {
  nodeId: string;
  logType: NodeType;
  nodeThreatSeverity: ThreatSeverity;
  isChainNode: boolean;
  chainNode?: ChainNode;
  storyNode?: StoryNode;
}

interface ChainNode {
  isRoot: boolean;
  isBroken: boolean;
  isAlarm: boolean;
  isExtensionNode: boolean;
  extensionDepth: number;
  alarmNodeInfo?: AlarmNodeInfo;
  processEntity?: ProcessEntity;
  entity?: any;
}

interface StoryNode {
  type: string;
  other: Record<string, any>;
}

interface ProcessEntity {
  processGuid: string;
  parentProcessGuid: string;
  processName: string;
  processId: string;
  image: string;
  commandline: string;
  processUserName: string;
  localtime: string;
  opType: string;
}

interface AlarmNodeInfo {
  alarmName: string;
  threatSeverity: ThreatSeverity;
  alarmDescription: string;
  dvcAction: string;
  alarmSource: string;
  alarmResults: string;
}

// ==================== è¾¹ç›¸å…³ ====================

interface ProcessEdge {
  source: string;
  target: string;
  val: string;
}

// ==================== æšä¸¾ç±»å‹ ====================

enum NodeType {
  PROCESS = "PROCESS",
  FILE = "FILE",
  NETWORK = "NETWORK",
  DOMAIN = "DOMAIN",
  REGISTRY = "REGISTRY",
  EXPLORE = "EXPLORE",
  UNKNOWN = "UNKNOWN"
}

enum ThreatSeverity {
  HIGH = "HIGH",
  MEDIUM = "MEDIUM",
  LOW = "LOW",
  UNKNOWN = "UNKNOWN"
}
```

### 7.2 å¸¸è§é—®é¢˜è§£ç­”

**Q1: isChainNode å¦‚ä½•ä½¿ç”¨ï¼Ÿ**

A: `isChainNode=true` è¡¨ç¤ºç«¯ä¾§è¿›ç¨‹é“¾èŠ‚ç‚¹ï¼Œä½¿ç”¨ `chainNode` å­—æ®µï¼›`isChainNode=false` è¡¨ç¤ºç½‘ä¾§æ•…äº‹çº¿èŠ‚ç‚¹ï¼Œä½¿ç”¨ `storyNode` å­—æ®µã€‚

**Q2: EXPLOREèŠ‚ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ**

A: EXPLOREèŠ‚ç‚¹æ˜¯ç³»ç»Ÿåœ¨æ— æ³•è¿½æº¯åˆ°çœŸå®æ ¹èŠ‚ç‚¹æ—¶è‡ªåŠ¨åˆ›å»ºçš„è™šæ‹Ÿæ ¹èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹IDæ ¼å¼ä¸º `EXPLORE_ROOT_{traceId}`ã€‚

**Q3: æ‰©å±•èŠ‚ç‚¹å¦‚ä½•è¯†åˆ«ï¼Ÿ**

A: é€šè¿‡ `chainNode.isExtensionNode=true` è¯†åˆ«ï¼Œ`extensionDepth` è¡¨ç¤ºæ‰©å±•æ·±åº¦ï¼ˆ0=åŸæ ¹ï¼Œ1=çˆ¶ï¼Œ2=ç¥–çˆ¶ï¼‰ã€‚

**Q4: å¦‚ä½•åŒºåˆ†ä¸åŒç±»å‹çš„è¾¹ï¼Ÿ**

A: é€šè¿‡ `edge.val` å­—æ®µåŒºåˆ†ï¼š
- "åˆ›å»ºè¿›ç¨‹": æ­£å¸¸çˆ¶å­è¿›ç¨‹å…³ç³»
- "æ¡¥æ¥": ç½‘ä¾§åˆ°ç«¯ä¾§çš„æ¡¥æ¥è¾¹
- "æ‰©å±•": æ‰©å±•æº¯æºçš„è¾¹

**Q5: å‘Šè­¦èŠ‚ç‚¹å¦‚ä½•é«˜äº®ï¼Ÿ**

A: æ£€æŸ¥ `chainNode.isAlarm=true`ï¼Œç„¶åä» `chainNode.alarmNodeInfo` è·å–å‘Šè­¦è¯¦æƒ…å’Œå¨èƒç­‰çº§ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-28  
**ç»´æŠ¤è€…**: Process Chain Team

ğŸ‰ **ç¥å‰ç«¯å¼€å‘é¡ºåˆ©ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»åç«¯å›¢é˜Ÿã€‚**


