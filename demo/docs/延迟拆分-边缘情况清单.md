# å»¶è¿Ÿæ‹†åˆ†ä¼˜åŒ– - è¾¹ç¼˜æƒ…å†µæ¸…å•

## ä¸€ã€å·²è€ƒè™‘çš„è¾¹ç¼˜æƒ…å†µ âœ…

| ç¼–å· | åœºæ™¯ | å¤„ç†æ–¹å¼ | çŠ¶æ€ |
|------|------|---------|------|
| 1 | **æ ¹èŠ‚ç‚¹ vs æ–­é“¾** | processGuid==traceId ä¼˜å…ˆçº§é«˜äºæ–­é“¾åˆ¤æ–­ | âœ… å·²å¤„ç† |
| 2 | **ç‰¹æ®Šæ ¹èŠ‚ç‚¹** | processGuid==parentGuid==traceIdï¼Œåˆ›å»ºè™šæ‹Ÿæ ¹çˆ¶èŠ‚ç‚¹ | âœ… å·²å¤„ç† |
| 3 | **å‘Šè­¦æ— æ—¥å¿—** | ä»å‘Šè­¦ä¸­æŠ½å–çˆ¶å­è¿›ç¨‹å’Œå®ä½“ | âœ… å·²å¤„ç† |
| 4 | **æ—¥å¿— + å‘Šè­¦åˆå¹¶** | èŠ‚ç‚¹çº§ä¼˜å…ˆçº§ï¼Œæ—¥å¿— > å‘Šè­¦ | âœ… å·²å¤„ç† |
| 5 | **ä¸€ä¸ªè¿›ç¨‹å¤šä¸ªå®ä½“** | éå†æ‰€æœ‰æ—¥å¿—/å‘Šè­¦ï¼Œæ¯æ¡ç‹¬ç«‹åˆ›å»ºå®ä½“ | âœ… å·²å¤„ç† |
| 6 | **è™šæ‹Ÿçˆ¶èŠ‚ç‚¹IDå†²çª** | éœ€è¦åŠ ä¸ŠtraceIdï¼ˆç”¨æˆ·æé†’ï¼‰ | âš ï¸ å¾…ä¿®å¤ |
| 7 | **è·¨traceIdæ‰©å±•** | æ‰©å±•æº¯æºä¸åº”è¿‡æ»¤traceId | âœ… å·²å¤„ç† |

---

## äºŒã€éœ€è¦æ·±å…¥è®¨è®ºçš„è¾¹ç¼˜æƒ…å†µ âš ï¸

### æƒ…å†µ1ï¼šè™šæ‹Ÿçˆ¶èŠ‚ç‚¹æœ¬èº«ä¹Ÿæœ‰çˆ¶èŠ‚ç‚¹ ğŸ¤”

**åœºæ™¯**ï¼š
```
å­å›¾ï¼š
  èŠ‚ç‚¹A (processGuid=A, parentGuid=B)

å»¶è¿Ÿæ‹†åˆ†ï¼š
  - åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹B (processGuid=B, parentGuid=hash_C)
  
é—®é¢˜ï¼šè™šæ‹ŸèŠ‚ç‚¹Bæœ¬èº«ä¹Ÿæœ‰parentGuidï¼ˆhash_Cï¼‰ï¼Œéœ€è¦ç»§ç»­åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹Cå—ï¼Ÿ
```

**æ½œåœ¨æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆAï¼šä¸é€’å½’åˆ›å»º**ï¼ˆæ¨èï¼‰
```java
// å»¶è¿Ÿæ‹†åˆ†åªå¤„ç†å­å›¾ä¸­åŸæœ‰çš„èŠ‚ç‚¹
for (GraphNode node : subgraph.getAllNodes()) {
    if (node.isVirtual()) {
        continue;  // âœ… è·³è¿‡è™šæ‹ŸèŠ‚ç‚¹
    }
    // å¤„ç†çœŸå®èŠ‚ç‚¹
}
```
- ä¼˜åŠ¿ï¼šç®€å•ï¼Œä¸ä¼šåˆ›å»ºå¤šå±‚è™šæ‹ŸèŠ‚ç‚¹
- åŠ£åŠ¿ï¼šè™šæ‹ŸèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¿¡æ¯ä¼šä¸¢å¤±

**æ–¹æ¡ˆBï¼šé€’å½’åˆ›å»ºï¼ˆæœ‰é™æ·±åº¦ï¼‰**
```java
// é€’å½’åˆ›å»ºè™šæ‹Ÿçˆ¶èŠ‚ç‚¹ï¼Œæœ€å¤š3å±‚
createVirtualParentsRecursive(subgraph, maxDepth=3);
```
- ä¼˜åŠ¿ï¼šé“¾æ›´å®Œæ•´
- åŠ£åŠ¿ï¼šå¯èƒ½åˆ›å»ºå¾ˆå¤šæ— ç”¨çš„è™šæ‹ŸèŠ‚ç‚¹

**æ–¹æ¡ˆCï¼šè™šæ‹ŸèŠ‚ç‚¹çš„parentGuidè®¾ä¸ºnull**ï¼ˆæœ€ç®€å•ï¼‰
```java
GraphNode virtualParent = createVirtualParentNode(...);
virtualParent.setParentProcessGuid(null);  // âœ… ç»ˆæ­¢å‘ä¸Šè¿½æº¯
```
- ä¼˜åŠ¿ï¼šæœ€ç®€å•ï¼Œæ˜ç¡®ç»ˆæ­¢
- åŠ£åŠ¿ï¼šä¸¢å¤±äº†çˆ¶èŠ‚ç‚¹ä¿¡æ¯

**ç”¨æˆ·æ„è§ï¼Ÿ** â†’ æ¨èæ–¹æ¡ˆC

---

### æƒ…å†µ2ï¼šè™šæ‹ŸèŠ‚ç‚¹ä¸çœŸå®èŠ‚ç‚¹çš„å†²çª ğŸ¤”

**åœºæ™¯**ï¼š
```
å…¨å›¾ï¼š
  èŠ‚ç‚¹A (processGuid=A, parentGuid=B)
  èŠ‚ç‚¹B (processGuid=B, parentGuid=C)  // çœŸå®èŠ‚ç‚¹B

å­å›¾æå–ï¼ˆä»Aå‘ä¸Šéå†ï¼‰ï¼š
  - Aåœ¨å­å›¾ä¸­
  - Båº”è¯¥ä¹Ÿåœ¨å­å›¾ä¸­ï¼ˆå› ä¸ºè¾¹Bâ†’Aå­˜åœ¨ï¼‰
  - æ‰€ä»¥ä¸ä¼šåˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹B âœ…

é—®é¢˜ï¼šå¦‚æœBæ²¡æœ‰è¢«éå†åˆ°ï¼ˆè¾¹æ²¡åˆ›å»ºï¼‰ï¼Œæ€ä¹ˆåŠï¼Ÿ
```

**åˆ†æ**ï¼š
- åœ¨å»¶è¿Ÿæ‹†åˆ†æ–¹æ¡ˆä¸­ï¼Œè¾¹åœ¨å»ºå›¾é˜¶æ®µå°±åˆ›å»ºäº†ï¼ˆBâ†’Aï¼‰
- å­å›¾æå–æ—¶ï¼Œä¼šæ²¿ç€è¾¹å‘ä¸Šéå†
- å¦‚æœBåœ¨å…¨å›¾ä¸­ï¼Œåº”è¯¥ä¼šè¢«éå†åˆ°
- å¦‚æœBæ²¡è¢«éå†åˆ°ï¼Œè¯´æ˜è¾¹æ²¡åˆ›å»ºï¼Œæˆ–è€…Båœ¨å…¨å›¾ä¸­ä¹Ÿä¸å­˜åœ¨

**ç»“è®º**ï¼š
- âœ… å¦‚æœBåœ¨å­å›¾ä¸­ï¼Œä¸åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹ï¼ˆæœ‰æ£€æŸ¥ï¼‰
- âœ… å¦‚æœBä¸åœ¨å­å›¾ä¸­ï¼Œåˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹ï¼ˆå³ä½¿å…¨å›¾ä¸­æœ‰Bï¼‰
- âœ… å»¶è¿Ÿæ‹†åˆ†åªæ“ä½œå­å›¾ï¼Œä¸è®¿é—®å…¨å›¾

**è¿™æ˜¯åˆç†çš„**ï¼Œå› ä¸ºï¼š
- å­å›¾æ˜¯"ç›¸å…³èŠ‚ç‚¹"çš„é›†åˆ
- å¦‚æœBæ²¡æœ‰è¢«éå†åˆ°ï¼Œè¯´æ˜å®ƒå’Œå‘Šè­¦é“¾ä¸ç›¸å…³
- å³ä½¿å…¨å›¾ä¸­æœ‰çœŸå®çš„Bï¼Œä¹Ÿä¸åº”è¯¥ä½¿ç”¨å®ƒ

---

### æƒ…å†µ3ï¼šæ‰¹é‡åˆ›å»º vs é€ä¸ªåˆ›å»º ğŸ¤”

**ç”¨æˆ·é—®é¢˜**ï¼š"æ˜¯è·å–å­æ ‘ä¹‹åï¼Œå…ˆéƒ½æ‹†å®Œå†åˆå¹¶è¿˜æ˜¯ä¸€ä¸ªèŠ‚ç‚¹æ‹†äº†ï¼Œçœ‹æœ‰æ²¡çœŸå®çš„çˆ¶è¿™æ ·"

**æ–¹æ¡ˆAï¼šæ‰¹é‡åˆ›å»º**ï¼ˆå½“å‰è®¾è®¡ï¼‰
```java
// ç¬¬1æ­¥ï¼šæ”¶é›†æ‰€æœ‰éœ€è¦åˆ›å»ºçš„è™šæ‹Ÿçˆ¶èŠ‚ç‚¹
Map<String, GraphNode> virtualParentsToAdd = new HashMap<>();
for (GraphNode node : subgraph.getAllNodes()) {
    if (node.isVirtual()) {
        continue;  // âœ… è·³è¿‡è™šæ‹ŸèŠ‚ç‚¹
    }
    
    String parentGuid = node.getParentProcessGuid();
    if (parentGuid != null && !subgraph.hasNode(parentGuid)) {
        GraphNode virtualParent = createVirtualParentNode(...);
        virtualParentsToAdd.put(parentGuid, virtualParent);
    }
}

// ç¬¬2æ­¥ï¼šæ‰¹é‡æ·»åŠ åˆ°å­å›¾
for (GraphNode virtualParent : virtualParentsToAdd.values()) {
    subgraph.addNode(virtualParent);
}
```

**ä¼˜åŠ¿**ï¼š
- âœ… ç®€å•æ¸…æ™°
- âœ… ä¸ä¼šé‡å¤åˆ›å»ºï¼ˆHashMapå»é‡ï¼‰
- âœ… æ€§èƒ½å¥½ï¼ˆä¸€æ¬¡éå†ï¼‰

**é—®é¢˜**ï¼š
- âš ï¸ æ–°åˆ›å»ºçš„è™šæ‹ŸèŠ‚ç‚¹æœ¬èº«å¯èƒ½ä¹Ÿæœ‰çˆ¶èŠ‚ç‚¹ï¼Œä½†ä¸ä¼šè¢«å¤„ç†
- âš ï¸ å¦‚æœè™šæ‹ŸèŠ‚ç‚¹Açš„çˆ¶èŠ‚ç‚¹Båœ¨å­å›¾ä¸­ï¼ˆçœŸå®èŠ‚ç‚¹ï¼‰ï¼Œä¸ä¼šæ£€æµ‹åˆ°

**ç­‰ç­‰**ï¼Œç¬¬äºŒä¸ªé—®é¢˜ä¸ä¼šå‘ç”Ÿï¼

è®©æˆ‘é‡æ–°åˆ†æï¼š
```
å­å›¾ï¼ˆåˆå§‹ï¼‰ï¼š
  èŠ‚ç‚¹A (parentGuid=B)
  èŠ‚ç‚¹B (parentGuid=C)
  èŠ‚ç‚¹C (parentGuid=D)

ç¬¬1æ­¥ï¼šéå†æ”¶é›†
  - å¤„ç†Aï¼šçˆ¶èŠ‚ç‚¹Båœ¨å­å›¾ä¸­ï¼Ÿæ˜¯ï¼Œè·³è¿‡ âœ…
  - å¤„ç†Bï¼šçˆ¶èŠ‚ç‚¹Cåœ¨å­å›¾ä¸­ï¼Ÿæ˜¯ï¼Œè·³è¿‡ âœ…
  - å¤„ç†Cï¼šçˆ¶èŠ‚ç‚¹Dåœ¨å­å›¾ä¸­ï¼Ÿå¦ï¼Œæ·»åŠ è™šæ‹ŸèŠ‚ç‚¹D âœ…

ç¬¬2æ­¥ï¼šæ‰¹é‡æ·»åŠ 
  - æ·»åŠ è™šæ‹ŸèŠ‚ç‚¹D

ç»“æœï¼šæ²¡æœ‰é—®é¢˜ âœ…
```

**æ‰€ä»¥æ–¹æ¡ˆAæ˜¯æ­£ç¡®çš„**ã€‚

---

**æ–¹æ¡ˆBï¼šé€ä¸ªåˆ›å»º**
```java
// é€ä¸ªå¤„ç†ï¼Œç«‹å³æ·»åŠ 
for (GraphNode node : subgraph.getAllNodes()) {
    String parentGuid = node.getParentProcessGuid();
    if (parentGuid != null && !subgraph.hasNode(parentGuid)) {
        GraphNode virtualParent = createVirtualParentNode(...);
        subgraph.addNode(virtualParent);  // âœ… ç«‹å³æ·»åŠ 
    }
}
```

**ä¼˜åŠ¿**ï¼š
- âœ… ç«‹å³æ·»åŠ ï¼Œåç»­èŠ‚ç‚¹å¯ä»¥æ£€æµ‹åˆ°

**é—®é¢˜**ï¼š
- âš ï¸ å¦‚æœå¤„ç†é¡ºåºä¸å½“ï¼Œå¯èƒ½é‡å¤åˆ›å»º
- âš ï¸ éœ€è¦é¢å¤–çš„å»é‡é€»è¾‘

**ä¾‹å­**ï¼š
```
èŠ‚ç‚¹A (parentGuid=X)
èŠ‚ç‚¹B (parentGuid=X)

å¦‚æœå…ˆå¤„ç†Aï¼šåˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹Xï¼Œæ·»åŠ åˆ°å­å›¾
ç„¶åå¤„ç†Bï¼šçˆ¶èŠ‚ç‚¹Xåœ¨å­å›¾ä¸­ï¼Ÿæ˜¯ï¼Œè·³è¿‡ âœ…

å¦‚æœå¤„ç†é¡ºåºä¿è¯ï¼Œä¹Ÿæ²¡é—®é¢˜ã€‚
```

**ç»“è®º**ï¼š
- æ–¹æ¡ˆAå’Œæ–¹æ¡ˆBéƒ½å¯ä»¥ï¼Œä½†æ–¹æ¡ˆAæ›´ç®€æ´
- **æ¨èæ–¹æ¡ˆA**

---

### æƒ…å†µ4ï¼šè™šæ‹ŸèŠ‚ç‚¹çš„è™šæ‹Ÿçˆ¶èŠ‚ç‚¹ï¼ˆé€’å½’é—®é¢˜ï¼‰ğŸ¤”

**åœºæ™¯**ï¼š
```
å»¶è¿Ÿæ‹†åˆ†ï¼ˆæ–¹æ¡ˆAï¼‰ï¼š
1. å¤„ç†çœŸå®èŠ‚ç‚¹Aï¼šåˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹B (parentGuid=hash_C)
2. æ‰¹é‡æ·»åŠ è™šæ‹ŸèŠ‚ç‚¹B
3. ç»“æŸ

é—®é¢˜ï¼šè™šæ‹ŸèŠ‚ç‚¹Bæœ¬èº«æœ‰parentGuid=hash_Cï¼Œè¦ä¸ºå®ƒåˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹Cå—ï¼Ÿ
```

**æ–¹æ¡ˆå¯¹æ¯”**ï¼š

| æ–¹æ¡ˆ | å¤„ç†æ–¹å¼ | ä¼˜åŠ¿ | åŠ£åŠ¿ |
|------|---------|------|------|
| **A. ä¸é€’å½’** | åªå¤„ç†åŸæœ‰èŠ‚ç‚¹ï¼Œè·³è¿‡è™šæ‹ŸèŠ‚ç‚¹ | ç®€å•ï¼Œæ€§èƒ½å¥½ | è™šæ‹ŸèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸¢å¤± |
| **B. é€’å½’ï¼ˆæœ‰é™ï¼‰** | ä¸ºè™šæ‹ŸèŠ‚ç‚¹ä¹Ÿåˆ›å»ºçˆ¶èŠ‚ç‚¹ï¼Œæœ€å¤š3å±‚ | é“¾æ›´å®Œæ•´ | å¯èƒ½åˆ›å»ºå¾ˆå¤šæ— ç”¨èŠ‚ç‚¹ |
| **C. ç»ˆæ­¢æ ‡è®°** | è™šæ‹ŸèŠ‚ç‚¹çš„parentGuidè®¾ä¸ºnull | æ˜ç¡®ç»ˆæ­¢ | ä¸¢å¤±çˆ¶èŠ‚ç‚¹ä¿¡æ¯ |

**æ¨èæ–¹æ¡ˆA**ï¼ŒåŸå› ï¼š
1. âœ… è™šæ‹ŸèŠ‚ç‚¹çš„parentGuidæ˜¯hashè®¡ç®—çš„ï¼Œé€šå¸¸ä¸å¯¹åº”çœŸå®èŠ‚ç‚¹
2. âœ… ä¸ºhashèŠ‚ç‚¹å†åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹ï¼Œæ„ä¹‰ä¸å¤§
3. âœ… æ€§èƒ½è€ƒè™‘ï¼šé¿å…åˆ›å»ºå¤§é‡æ— ç”¨èŠ‚ç‚¹

**å®ç°**ï¼š
```java
for (GraphNode node : subgraph.getAllNodes()) {
    if (node.isVirtual()) {
        continue;  // âœ… è·³è¿‡è™šæ‹ŸèŠ‚ç‚¹ï¼Œä¸ä¸ºå®ƒåˆ›å»ºçˆ¶èŠ‚ç‚¹
    }
    // å¤„ç†çœŸå®èŠ‚ç‚¹
}
```

---

## ä¸‰ã€å…¶ä»–æ½œåœ¨è¾¹ç¼˜æƒ…å†µ ğŸ¤”

### æƒ…å†µ5ï¼šå‘Šè­¦å­—æ®µç¼ºå¤±

**åœºæ™¯**ï¼š
```
å‘Šè­¦ï¼š
  processGuid = "A"
  parentProcessGuid = "B"
  ä½†æ˜¯ï¼šparentProcessName = null, parentImage = null
```

**å¤„ç†**ï¼š
```java
GraphNode virtualParent = new GraphNode();
virtualParent.setProcessGuid(parentGuid);
virtualParent.setParentProcessGuid(null);  // âœ… æ— æ³•è®¡ç®—ï¼Œè®¾ä¸ºnull
// å…¶ä»–å­—æ®µå°½é‡å¡«å……ï¼Œä½†å¯èƒ½ä¸ºç©º
```

**å½±å“**ï¼š
- è™šæ‹Ÿçˆ¶èŠ‚ç‚¹çš„ä¿¡æ¯ä¸å®Œæ•´
- ä½†ä¸å½±å“é“¾çš„ç»“æ„

---

### æƒ…å†µ6ï¼šç½‘ç»œå®ä½“çš„æœ¬æœºè¿‡æ»¤

**åœºæ™¯**ï¼š
```
å‘Šè­¦ï¼š
  destAddress = "10.0.0.1"
  hostAddress = "10.0.0.1"
```

**å¤„ç†**ï¼š
```java
if (alarm.getDestAddress() != null && 
    !alarm.getDestAddress().equals(alarm.getHostAddress())) {
    // âœ… åˆ›å»ºç½‘ç»œå®ä½“
} else {
    // âŒ è·³è¿‡ï¼ˆæœ¬æœºé€šä¿¡ï¼‰
}
```

**é—®é¢˜**ï¼šå¦‚æœæ—¥å¿—å’Œå‘Šè­¦çš„åˆ¤æ–­é€»è¾‘ä¸ä¸€è‡´æ€ä¹ˆåŠï¼Ÿ

**è§£å†³**ï¼šç»Ÿä¸€åˆ¤æ–­é€»è¾‘ï¼Œæ—¥å¿—å’Œå‘Šè­¦éƒ½ä½¿ç”¨ç›¸åŒçš„æ¡ä»¶ã€‚

---

### æƒ…å†µ7ï¼šå®ä½“èŠ‚ç‚¹IDå†²çª

**åœºæ™¯**ï¼š
```
åŒä¸€ä¸ªè¿›ç¨‹åˆ›å»ºä¸¤ä¸ªç›¸åŒåå­—çš„æ–‡ä»¶ï¼š
  æ—¥å¿—1ï¼šprocessGuid=A, targetFilename="test.txt"
  æ—¥å¿—2ï¼šprocessGuid=A, targetFilename="test.txt"

å¦‚æœå®ä½“èŠ‚ç‚¹IDæ˜¯ hash(processGuid + targetFilename)ï¼Œä¼šå†²çªï¼
```

**å¤„ç†**ï¼š
```java
// å®ä½“èŠ‚ç‚¹IDåº”è¯¥åŒ…å«æ›´å¤šä¿¡æ¯ï¼Œé¿å…å†²çª
String entityId = hash(processGuid + targetFilename + timestamp + opType);
```

**æˆ–è€…**ï¼š
```java
// æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å·²å­˜åœ¨
if (!graph.hasNode(entityId)) {
    graph.addNode(entityNode);
} else {
    // åˆå¹¶åˆ°å·²æœ‰èŠ‚ç‚¹ï¼ˆæ›´æ–°ä¿¡æ¯ï¼‰
}
```

---

## å››ã€æ€»ç»“ä¸å»ºè®®

### æ ¸å¿ƒå†³ç­–

| é—®é¢˜ | æ¨èæ–¹æ¡ˆ | åŸå›  |
|------|---------|------|
| **è™šæ‹ŸèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹** | ä¸é€’å½’åˆ›å»ºï¼Œè·³è¿‡è™šæ‹ŸèŠ‚ç‚¹ | ç®€å•ï¼Œæ€§èƒ½å¥½ |
| **æ‰¹é‡ vs é€ä¸ª** | æ‰¹é‡åˆ›å»ºï¼ˆæ–¹æ¡ˆAï¼‰ | ç®€æ´ï¼Œä¸ä¼šé‡å¤ |
| **è™šæ‹Ÿ vs çœŸå®** | å»¶è¿Ÿæ‹†åˆ†åªæ“ä½œå­å›¾ | é€»è¾‘æ¸…æ™° |

### å®ç°è¦ç‚¹

```java
/**
 * ä¸ºå­å›¾èŠ‚ç‚¹åˆ›å»ºè™šæ‹Ÿçˆ¶èŠ‚ç‚¹ï¼ˆå»¶è¿Ÿæ‹†åˆ†ï¼‰
 */
private void createVirtualParentsForSubgraph(ProcessChainGraph subgraph, Set<String> traceIds) {
    Map<String, GraphNode> virtualParentsToAdd = new HashMap<>();
    
    // âœ… åªå¤„ç†å­å›¾ä¸­åŸæœ‰çš„çœŸå®èŠ‚ç‚¹
    for (GraphNode node : subgraph.getAllNodes()) {
        // âœ… è·³è¿‡è™šæ‹ŸèŠ‚ç‚¹ï¼ˆé‡è¦ï¼ï¼‰
        if (node.isVirtual()) {
            continue;
        }
        
        String parentGuid = node.getParentProcessGuid();
        
        // æ£€æŸ¥çˆ¶èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨
        if (parentGuid == null || subgraph.hasNode(parentGuid)) {
            continue;
        }
        
        // æ£€æŸ¥æ˜¯å¦å·²ç»åœ¨å¾…æ·»åŠ åˆ—è¡¨ä¸­
        if (virtualParentsToAdd.containsKey(parentGuid)) {
            continue;
        }
        
        // åˆ›å»ºè™šæ‹Ÿçˆ¶èŠ‚ç‚¹
        GraphNode virtualParent = createVirtualParentNode(node, parentGuid);
        // âœ… è™šæ‹ŸèŠ‚ç‚¹çš„parentGuidè®¾ä¸ºnullï¼ˆç»ˆæ­¢å‘ä¸Šè¿½æº¯ï¼‰
        virtualParent.setParentProcessGuid(null);
        
        virtualParentsToAdd.put(parentGuid, virtualParent);
    }
    
    // æ‰¹é‡æ·»åŠ 
    for (GraphNode virtualParent : virtualParentsToAdd.values()) {
        subgraph.addNode(virtualParent);
    }
}
```

### æµ‹è¯•æ¸…å•

- [ ] è™šæ‹ŸèŠ‚ç‚¹ä¸ä¼šè¢«å†æ¬¡å¤„ç†
- [ ] è™šæ‹ŸèŠ‚ç‚¹çš„parentGuidä¸ºnull
- [ ] æ‰¹é‡åˆ›å»ºä¸ä¼šé‡å¤
- [ ] å­å›¾ä¸­çš„çœŸå®çˆ¶èŠ‚ç‚¹ä¸ä¼šè¢«è™šæ‹ŸèŠ‚ç‚¹è¦†ç›–
- [ ] å‘Šè­¦å­—æ®µç¼ºå¤±æ—¶çš„å¤„ç†
- [ ] ç½‘ç»œå®ä½“çš„æœ¬æœºè¿‡æ»¤
- [ ] å®ä½“èŠ‚ç‚¹IDå†²çªçš„å¤„ç†




