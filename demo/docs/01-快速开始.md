# 快速开始指南

**5分钟快速上手 Process Chain Generator**

---

## 📋 环境要求

- ☕ **Java**: 8 或以上
- 📦 **Maven**: 3.6 或以上
- 🔍 **Elasticsearch**: 7.17+ （可选，用于实际ES查询）

---

## 🚀 快速安装

### 1. 克隆项目
```bash
git clone <your-repo-url>
cd demo
```

### 2. 编译项目
```bash
mvn clean install
```

### 3. 运行项目
```bash
mvn spring-boot:run
```

或使用启动脚本（Windows）:
```bash
start.bat
```

---

## 🎯 核心功能一览

| 功能 | 说明 | 状态 |
|------|------|------|
| 进程链构建 | 从告警和日志构建完整的进程执行链 | ✅ |
| 断链自动修复 | 自动检测并修复断链（Explore节点） | ✅ |
| 智能裁剪 | 保留关键攻击路径，删除冗余节点 | ✅ |
| 网端端侧合并 | 合并网络侧和端点侧的进程链 | ✅ |
| 多IP支持 | 支持同时处理多个IP的进程链 | ✅ |
| 告警选举 | 从多个告警组中选出最严重的组 | ✅ |

---

## 📝 REST API 快速示例

### 1. 构建单个IP的进程链

**接口**: `POST /api/process-chain/build`

**请求示例**:
```json
{
  "ip": "192.168.1.100",
  "traceId": "TRACE_001"
}
```

**响应示例**:
```json
{
  "traceIds": ["TRACE_001"],
  "hostAddresses": ["192.168.1.100"],
  "nodes": [
    {
      "nodeId": "TRACE_001",
      "logType": "PROCESS",
      "chainNode": {
        "isRoot": true,
        "isAlarm": true
      },
      "processEntity": {
        "processName": "malware.exe",
        "commandLine": "C:\\malware.exe --start"
      }
    }
  ],
  "edges": [...]
}
```

### 2. 合并多个IP的进程链

**接口**: `POST /api/process-chain/merge`

**请求示例**:
```json
{
  "ipMappingRelation": {
    "alarmIps": {
      "192.168.1.100": "EVENT_001",
      "192.168.1.101": "EVENT_002"
    },
    "ipAndAssociation": {
      "192.168.1.100": true,
      "192.168.1.101": false
    }
  },
  "networkNodes": [...],
  "networkEdges": [...]
}
```

---

## 🧪 运行测试

### 运行所有测试
```bash
mvn test
```

### 运行特定测试
```bash
# 核心逻辑测试
mvn test -Dtest=CoreLogicTest

# 集成测试
mvn test -Dtest=ProcessChainIntegrationTest

# 裁剪测试
mvn test -Dtest=ProcessChainPrunerTest
```

### 查看测试报告
测试报告位于：`target/surefire-reports/`

---

## 📊 数据模型

### RawAlarm（原始告警）
```java
{
  "eventId": "EVENT_001",           // 告警ID
  "traceId": "TRACE_001",           // 溯源ID（根节点ID）
  "processGuid": "GUID_001",        // 进程GUID
  "parentProcessGuid": "GUID_000",  // 父进程GUID
  "alarmName": "恶意进程启动",
  "threatSeverity": "高",           // 威胁等级：高/中/低
  "hostAddress": "192.168.1.100",
  "startTime": "2024-01-15 10:00:00"
}
```

### RawLog（原始日志）
```java
{
  "processGuid": "GUID_001",
  "parentProcessGuid": "GUID_000",
  "traceId": "TRACE_001",
  "logType": "process",             // 日志类型：process/file/network/domain
  "eventType": "processCreate",
  "processName": "cmd.exe",
  "commandLine": "cmd.exe /c whoami",
  "hostAddress": "192.168.1.100",
  "startTime": "2024-01-15 10:00:01"
}
```

### IncidentProcessChain（进程链结果）
```java
{
  "traceIds": ["TRACE_001"],        // 溯源ID列表
  "hostAddresses": ["192.168.1.100"], // 主机IP列表
  "nodes": [                         // 节点列表
    {
      "nodeId": "GUID_001",
      "logType": "PROCESS",
      "isChainNode": true,
      "chainNode": {...},            // 进程链节点信息
      "processEntity": {...}         // 进程实体信息
    }
  ],
  "edges": [                         // 边列表
    {
      "source": "GUID_000",
      "target": "GUID_001",
      "val": "进程创建"
    }
  ]
}
```

---

## 🔍 核心概念

### 1. 根节点识别
根节点是进程链的起点，识别规则：
```
根节点条件：processGuid == traceId && parentProcessGuid == null
```

### 2. 断链处理（Explore节点）
当找不到根节点时，自动创建虚拟根节点：
```
EXPLORE_ROOT (虚拟根节点)
  ├── BROKEN_NODE_1 (断链节点1)
  ├── BROKEN_NODE_2 (断链节点2)
  └── BROKEN_NODE_3 (断链节点3)
```

### 3. 告警等级影响遍历策略
```
高危告警 → 双向遍历（向上+向下） → 包含子节点
中危告警 → 向上遍历         → 不包含子节点
低危告警 → 向上遍历         → 不包含子节点
```

### 4. 智能裁剪策略
```
1. 强制保留：根节点、告警节点、网端关联节点
2. 级联保留：从关键节点到根节点的完整路径
3. 选择性保留：按分数选择其他节点
4. 异常回滚：裁剪失败自动恢复原始数据
```

---

## 📚 下一步

- 📖 查看 [核心功能说明](02-核心功能说明.md) 了解详细功能
- 🔧 查看 [API文档](03-API文档.md) 了解所有接口
- 📝 查看 [项目详细说明](../项目详细说明文档.md) 了解完整设计
- 🧪 查看 [测试指南](guides/测试指南.md) 了解测试方法

---

## ❓ 常见问题

### Q1: 如何连接到Elasticsearch？
**A**: 配置 `application.yml` 中的 `spring.elasticsearch.rest.uris`

### Q2: 测试失败怎么办？
**A**: 检查是否配置了ES连接。核心逻辑测试不需要ES连接。

### Q3: 如何调整节点数量限制？
**A**: 修改 `ProcessChainConstants.java` 中的 `MAX_NODE_COUNT`

### Q4: 支持哪些日志类型？
**A**: 支持 process（进程）、file（文件）、network（网络）、domain（域名）、registry（注册表）

### Q5: 如何添加新的节点类型？
**A**: 
1. 在 `NodeType.java` 添加新类型
2. 在 `ProcessChainConstants.LogType` 添加常量
3. 在 `IncidentConverters` 添加转换逻辑

---

## 🆘 获取帮助

- 📖 查看完整文档：`docs/` 目录
- 🐛 报告问题：提交 Issue
- 💬 讨论交流：联系项目维护者

---

**🎉 恭喜！你已经完成快速入门！**

继续探索更多功能吧！







