# 命令执行攻击案例链关系图

## 案例1 - 基础案例 (IP: 10.50.109.192)

```
系统进程链
┌─────────────────────────────────────────────────────────────┐
│ System → smss → winlogon → userinit → explorer → cmd.exe    │
└─────────────────────────────────────────────────────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ whoami.exe  │ ← ROOT
                                                      │ (命令执行)  │
                                                      └─────────────┘
```

## 案例2 - 长链场景 (IP: 192.168.2.101)

```
系统进程链
┌─────────────────────────────────────────────────────────────┐
│ System → smss → winlogon → userinit → explorer → cmd.exe    │
└─────────────────────────────────────────────────────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ whoami.exe  │ ← ROOT
                                                      │ (身份查询)  │
                                                      └─────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ systeminfo  │
                                                      │ (系统信息)  │
                                                      └─────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ netstat.exe │
                                                      │ (网络扫描)  │
                                                      └─────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ powershell  │
                                                      │ (后门程序)  │
                                                      └─────────────┘
```

## 案例3 - 分支链场景 (IP: 192.168.2.102)

```
系统进程链
┌─────────────────────────────────────────────────────────────┐
│ System → smss → winlogon → userinit → explorer → cmd.exe    │
└─────────────────────────────────────────────────────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ whoami.exe  │ ← ROOT
                                                      │ (身份查询)  │
                                                      └─────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ systeminfo  │
                                                      │ (系统信息)  │
                                                      └─────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ netstat.exe │
                                                      │ (网络扫描)  │
                                                      └─────────────┘
                                                              │
                                                              ├─────────────────┐
                                                              ▼                 ▼
                                                      ┌─────────────┐   ┌─────────────┐
                                                      │ powershell  │   │ tasklist    │
                                                      │ (后门程序)  │   │ (进程列表)  │
                                                      └─────────────┘   └─────────────┘
```

## 案例4 - 断链场景 (IP: 192.168.2.103)

```
系统进程链
┌─────────────────────────────────────────────────────────────┐
│ System → smss → winlogon → userinit → explorer → cmd.exe    │
└─────────────────────────────────────────────────────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ whoami.exe  │ ← ROOT
                                                      │ (身份查询)  │
                                                      └─────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ systeminfo  │
                                                      │ (系统信息)  │
                                                      └─────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │   [断链]    │
                                                      └─────────────┘

独立进程链
┌─────────────────────────────────────────────────────────────┐
│ System → smss → winlogon → userinit → explorer             │
└─────────────────────────────────────────────────────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ regedit.exe │
                                                      │ (独立恶意)  │
                                                      └─────────────┘
```

## 链关系总结

### 链类型对比

| 案例 | 链类型 | 节点数 | 分支数 | 断链数 | 复杂度 |
|------|--------|--------|--------|--------|--------|
| 案例1 | 基础链 | 1 | 0 | 0 | 低 |
| 案例2 | 长链 | 4 | 0 | 0 | 中 |
| 案例3 | 分支链 | 5 | 2 | 0 | 高 |
| 案例4 | 断链 | 3+1 | 0 | 1 | 中 |

### 攻击技术映射

| 进程 | 技术ID | 技术名称 | 描述 |
|------|--------|----------|------|
| whoami | T1033 | 系统信息发现 | 用户身份查询 |
| systeminfo | T1082 | 系统信息发现 | 系统配置信息收集 |
| netstat | T1046 | 网络服务扫描 | 网络连接状态查看 |
| powershell | T1059.001 | PowerShell | 后门程序执行 |
| tasklist | T1057 | 进程发现 | 运行进程列表 |
| regedit | T1547.001 | 注册表自启动 | 持久化机制 |

### 测试验证点

1. **基础功能**
   - ✅ 进程链构建
   - ✅ 网端关联
   - ✅ 根节点识别

2. **长链处理**
   - ✅ 线性链构建
   - ✅ 时间顺序
   - ✅ 父子关系

3. **分支处理**
   - ✅ 分支识别
   - ✅ 多分支构建
   - ✅ 分支独立性

4. **断链处理**
   - ✅ 断链检测
   - ✅ 独立进程处理
   - ✅ 数据分离

5. **IP隔离**
   - ✅ 不同IP隔离
   - ✅ 同IP关联
   - ✅ 网端匹配
