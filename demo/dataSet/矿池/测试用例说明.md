# 矿池攻击测试用例说明

## 快速开始

### 1. 案例1 - 基础测试
```bash
# 测试基础进程链构建
输入: 案例1/endpoint1.json + 案例1/network1.json
预期: 1节点进程链，根节点为MsCpuCN64.exe
验证: 网端关联正确，traceId一致
```

### 2. 案例2 - 长链测试
```bash
# 测试线性长链处理
输入: 案例2/endpoint1-4.json + 案例2/network1.json
预期: 4节点线性链，无分支
验证: 时间顺序正确，父子关系完整
```

### 3. 案例3 - 分支测试
```bash
# 测试分支链处理
输入: 案例3/endpoint1-5.json + 案例3/network1.json
预期: 5节点分支链，2个分支
验证: 分支正确识别，独立性保持
```

### 4. 案例4 - 断链测试
```bash
# 测试断链处理
输入: 案例4/endpoint1-3.json + 案例4/network1.json
预期: 3节点主链 + 1个独立进程
验证: 断链正确检测，独立进程处理
```

## 关键验证点

### 进程链构建
- [ ] 根节点识别: `processGuid = "2FBB5B6F58FF8A29"`
- [ ] 父子关系: `parentProcessGuid` 正确匹配
- [ ] 时间顺序: `processStartTime` 递增
- [ ] 链完整性: 无缺失节点

### 网端关联
- [ ] IP匹配: 端点IP与网络IP一致
- [ ] 时间窗口: 网络时间与端点时间重叠
- [ ] 机构匹配: `srcOrgId` 和 `destOrgId` 一致
- [ ] 安全域: `srcSecurityZone` 和 `destSecurityZone` 匹配

### 矿池特征检测
- [ ] 矿池地址: `requestDomain` 字段识别
- [ ] 挖矿算法: 命令行参数分析
- [ ] 资源使用: CPU亲和性和线程数
- [ ] 挖矿强度: 命令行参数解析

### 特殊场景
- [ ] 分支处理: 多个矿池同时挖矿
- [ ] 断链检测: `parentProcessId = 0` 的进程
- [ ] IP隔离: 不同IP的进程链不混淆
- [ ] 空值处理: 缺失字段的正确处理

## 预期结果

### 案例1结果
```json
{
  "nodes": 1,
  "edges": 0,
  "rootNode": "2FBB5B6F58FF8A29",
  "chainType": "single",
  "ipAddress": "10.50.109.192",
  "miningPool": "mine.ppxxmr.com:3333"
}
```

### 案例2结果
```json
{
  "nodes": 4,
  "edges": 3,
  "rootNode": "2FBB5B6F58FF8A29",
  "chainType": "linear",
  "ipAddress": "192.168.3.101",
  "path": ["MsCpuCN64", "MsCpuCN64", "MsCpuCN64", "MsCpuCN64"],
  "miningConfig": {
    "pool": "mine.ppxxmr.com:3333",
    "threads": 4,
    "intensity": 15
  }
}
```

### 案例3结果
```json
{
  "nodes": 5,
  "edges": 4,
  "rootNode": "2FBB5B6F58FF8A29",
  "chainType": "branch",
  "ipAddress": "192.168.3.102",
  "branches": [
    ["MsCpuCN64", "MsCpuCN64", "MsCpuCN64", "MsCpuCN64"],
    ["MsCpuCN64", "MsCpuCN64", "MsCpuCN64", "xmrig"]
  ],
  "miningPools": [
    "mine.ppxxmr.com:3333",
    "pool.minexmr.com:4444"
  ]
}
```

### 案例4结果
```json
{
  "nodes": 4,
  "edges": 2,
  "rootNode": "2FBB5B6F58FF8A29",
  "chainType": "broken",
  "ipAddress": "192.168.3.103",
  "mainChain": ["MsCpuCN64", "MsCpuCN64"],
  "isolatedProcess": "UNKNOWN",
  "miningPool": "mine.ppxxmr.com:3333"
}
```

## 性能指标

| 案例 | 节点数 | 预期处理时间 | 内存使用 | 复杂度 |
|------|--------|--------------|----------|--------|
| 案例1 | 1 | < 50ms | < 5MB | O(1) |
| 案例2 | 4 | < 150ms | < 15MB | O(n) |
| 案例3 | 5 | < 200ms | < 20MB | O(n) |
| 案例4 | 4 | < 180ms | < 18MB | O(n) |

## 矿池特征分析

### 支持的矿池
- **mine.ppxxmr.com:3333**: CryptoNight算法
- **pool.minexmr.com:4444**: RandomX算法

### 挖矿参数
- **CPU亲和性**: `--cpu-affinity 0x3`
- **线程数**: `--threads 4`
- **挖矿强度**: `--intensity 15`

### 检测规则
1. 进程名包含: `MsCpuCN64`, `xmrig`, `minerd`
2. 命令行包含: `stratum+tcp://`, `-o`, `-u`, `-p`
3. 域名请求: 矿池域名解析
4. 网络连接: 矿池端口连接

## 故障排除

### 常见问题
1. **链构建失败**: 检查 `processGuid` 和 `parentProcessGuid` 匹配
2. **网端关联失败**: 验证IP地址和时间窗口
3. **矿池识别失败**: 检查域名和端口信息
4. **断链检测失败**: 验证 `parentProcessId = 0` 的进程

### 调试建议
- 启用详细日志记录
- 检查时间戳格式
- 验证JSON数据完整性
- 监控内存使用情况
- 分析挖矿参数配置
