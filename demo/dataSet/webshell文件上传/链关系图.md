# WebShell攻击案例链关系图

## 案例1 - 基础案例 (IP: 10.50.109.192)

```
系统进程链
┌─────────────────────────────────────────────────────────────┐
│ System → smss → winlogon → userinit → explorer → phpstudy   │
└─────────────────────────────────────────────────────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ xp.cn_cgi   │
                                                      └─────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ php-cgi     │ ← ROOT
                                                      │ (WebShell)  │
                                                      └─────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ php-cgi     │
                                                      │ (创建文件)  │
                                                      └─────────────┘
```

## 案例2 - 长链场景 (IP: 192.168.1.101)

```
系统进程链
┌─────────────────────────────────────────────────────────────┐
│ System → smss → winlogon → userinit → explorer → phpstudy   │
└─────────────────────────────────────────────────────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ xp.cn_cgi   │
                                                      └─────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ php-cgi     │ ← ROOT
                                                      │ (WebShell)  │
                                                      └─────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ cmd.exe     │
                                                      │ (命令执行)  │
                                                      └─────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ powershell  │
                                                      │ (后门程序)  │
                                                      └─────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ reg.exe     │
                                                      │ (持久化)    │
                                                      └─────────────┘
```

## 案例3 - 分支链场景 (IP: 192.168.1.102)

```
系统进程链
┌─────────────────────────────────────────────────────────────┐
│ System → smss → winlogon → userinit → explorer → phpstudy   │
└─────────────────────────────────────────────────────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ xp.cn_cgi   │
                                                      └─────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ php-cgi     │ ← ROOT
                                                      │ (WebShell)  │
                                                      └─────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ cmd.exe     │
                                                      │ (命令执行)  │
                                                      └─────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ powershell  │
                                                      │ (后门程序)  │
                                                      └─────────────┘
                                                              │
                                                              ├─────────────────┐
                                                              ▼                 ▼
                                                      ┌─────────────┐   ┌─────────────┐
                                                      │ reg.exe     │   │ netstat.exe │
                                                      │ (数据窃取)  │   │ (网络扫描)  │
                                                      └─────────────┘   └─────────────┘
```

## 案例4 - 断链场景 (IP: 192.168.1.103)

```
系统进程链
┌─────────────────────────────────────────────────────────────┐
│ System → smss → winlogon → userinit → explorer → phpstudy   │
└─────────────────────────────────────────────────────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ xp.cn_cgi   │
                                                      └─────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ php-cgi     │ ← ROOT
                                                      │ (WebShell)  │
                                                      └─────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ cmd.exe     │
                                                      │ (命令执行)  │
                                                      └─────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │   [断链]    │
                                                      └─────────────┘

独立进程链
┌─────────────────────────────────────────────────────────────┐
│ System → smss → winlogon → userinit → explorer             │
└─────────────────────────────────────────────────────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ notepad.exe │
                                                      │ (独立恶意)  │
                                                      └─────────────┘
```

## 链关系总结

### 链类型对比

| 案例 | 链类型 | 节点数 | 分支数 | 断链数 | 复杂度 |
|------|--------|--------|--------|--------|--------|
| 案例1 | 基础链 | 2 | 0 | 0 | 低 |
| 案例2 | 长链 | 4 | 0 | 0 | 中 |
| 案例3 | 分支链 | 5 | 2 | 0 | 高 |
| 案例4 | 断链 | 3+1 | 0 | 1 | 中 |

### 攻击技术映射

| 进程 | 技术ID | 技术名称 | 描述 |
|------|--------|----------|------|
| php-cgi | T1105 | 入口工具传输 | WebShell文件上传 |
| cmd.exe | T1505.003 | Web Shell | 命令执行 |
| powershell | T1059.001 | PowerShell | 后门程序执行 |
| reg.exe | T1547.001 | 注册表自启动 | 持久化 |
| netstat | T1046 | 网络服务扫描 | 网络发现 |

### 测试验证点

1. **基础功能**
   - ✅ 进程链构建
   - ✅ 网端关联
   - ✅ 根节点识别

2. **长链处理**
   - ✅ 线性链构建
   - ✅ 时间顺序
   - ✅ 父子关系

3. **分支处理**
   - ✅ 分支识别
   - ✅ 多分支构建
   - ✅ 分支独立性

4. **断链处理**
   - ✅ 断链检测
   - ✅ 独立进程处理
   - ✅ 数据分离

5. **IP隔离**
   - ✅ 不同IP隔离
   - ✅ 同IP关联
   - ✅ 网端匹配
