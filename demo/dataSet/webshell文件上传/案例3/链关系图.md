# Webshellæ–‡ä»¶ä¸Šä¼  - æ¡ˆä¾‹3 é“¾å…³ç³»å›¾

## å®Œæ•´æ”»å‡»é“¾è§†å›¾ï¼ˆ20ä¸ªèŠ‚ç‚¹ï¼‰

```
ğŸŒ [ç½‘ä¾§] æ£€æµ‹åˆ°ä¸Šä¼ å†°èwebshellæ–‡ä»¶(PHP)
æ¥æº: 10.50.86.152:51343 â†’ ç›®çš„: 10.50.111.194:80 (HTTP)
å¨èƒ: Webshellåé—¨è®¿é—®äº‹ä»¶ [HIGH]
â”‚
â”‚ æ¡¥æ¥åˆ°ç«¯ä¾§è¿›ç¨‹æ ‘
â†“

ç«¯ä¾§ [Endpoint Side] - ä¸»æœº: 10.50.111.194
â”‚
RuntimeBroker.exe (PID:425) [ç¥–çˆ¶èŠ‚ç‚¹]
â”œâ”€â”€ phpstudy_pro.exe (PID:6993) [çˆ¶èŠ‚ç‚¹]
â”‚   â”œâ”€â”€ â­ nginx.exe (PID:2001) [ROOT,ALARM] ğŸš¨æ ¹èŠ‚ç‚¹
â”‚   â”‚   â”œâ”€â”€ worker_process.exe (PID:2002)
â”‚   â”‚   â”‚   â”œâ”€â”€ http_module.exe (PID:5001)
â”‚   â”‚   â”‚   â””â”€â”€ ssl_module.exe (PID:5002)
â”‚   â”‚   â”œâ”€â”€ cache_manager.exe (PID:2003)
â”‚   â”‚   â”‚   â”œâ”€â”€ cache_loader.exe (PID:5003)
â”‚   â”‚   â”‚   â””â”€â”€ cache_purger.exe (PID:5004)
â”‚   â”‚   â””â”€â”€ php-cgi.exe (PID:229)
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ bello.php (Backdoor/PHP.WebShell.ek) [HIGH]
â”‚   â”‚       â””â”€â”€ ğŸ”§ HKLM\...\Run\Backdoor (æŒä¹…åŒ–) [MEDIUM]
â”‚   â””â”€â”€ xp.cn_cgi.exe (PID:3041)
â”‚
â””â”€â”€ explorer.exe (PID:3001)
    â”œâ”€â”€ notepad.exe (PID:3002)
    â”œâ”€â”€ calc.exe (PID:3003)
    â”œâ”€â”€ mspaint.exe (PID:6001)
    â””â”€â”€ cmd.exe (PID:6002)
```

## æ”»å‡»é“¾è¯´æ˜

### 1. åˆå§‹å…¥ä¾µ (Initial Access)
- **ç½‘ä¾§å‘Šè­¦**: 10.50.86.152 é€šè¿‡HTTPä¸Šä¼ å†°èwebshellåˆ° 10.50.111.194:80
- **æ”»å‡»æ‰‹æ³•**: TA0001/T1190 - åˆ©ç”¨é¢å‘å…¬ä¼—çš„åº”ç”¨ç¨‹åº

### 2. æ‰§è¡Œ (Execution)
- **æ ¹èŠ‚ç‚¹**: `nginx.exe` (PID:2001) ä½œä¸ºWebæœåŠ¡å™¨ä¸»è¿›ç¨‹
  - `processGuid = traceId-987` (æ ¹èŠ‚ç‚¹æ ‡è¯†)
  - å‘ä¸Šæº¯æº: phpstudy_pro.exe â†’ RuntimeBroker.exe (æœ€å¤š2å±‚)
- **æ¶æ„è½½è·**: php-cgi.exe å¤„ç†ä¸Šä¼ çš„webshellæ–‡ä»¶

### 3. æŒä¹…åŒ– (Persistence)
- **æ³¨å†Œè¡¨ä¿®æ”¹**: `HKLM\Software\Microsoft\Windows\CurrentVersion\Run\Backdoor`
- **å¯åŠ¨é¡¹**: æ·»åŠ  bello.php åˆ°ç³»ç»Ÿå¯åŠ¨é¡¹

### 4. è¿›ç¨‹æ ‘ç»“æ„
- **nginxä¸»è¿›ç¨‹**: 2ä¸ªå·¥ä½œè¿›ç¨‹åˆ†æ”¯
  - `worker_process.exe`: å¤„ç†HTTP/SSLè¯·æ±‚ (http_module, ssl_module)
  - `cache_manager.exe`: ç¼“å­˜ç®¡ç† (cache_loader, cache_purger)
- **php-cgi.exe**: æ‰§è¡ŒPHPè„šæœ¬ï¼Œåˆ›å»ºwebshellæ–‡ä»¶
- **å¹¶è¡Œåˆ†æ”¯**: explorer.exe åŠå…¶å­è¿›ç¨‹ (notepad, calc, mspaint, cmd)

## TraceID è§„åˆ™éªŒè¯

| è¿›ç¨‹ | ProcessGuid | TraceId | å…³ç³» |
|------|-------------|---------|------|
| RuntimeBroker.exe | BCA9487DC98F16A8 | **traceId-grandpa-C98F16A8** | ç¥–çˆ¶èŠ‚ç‚¹ |
| phpstudy_pro.exe | E3E5C129C46B2113 | **traceId-parent-C46B2113** | çˆ¶èŠ‚ç‚¹ |
| **nginx.exe** [ROOT] | **traceId-987** | **traceId-987** | æ ¹èŠ‚ç‚¹ |
| worker_process.exe | 4A3B2C1D0E9F8A7B | traceId-987 | å­èŠ‚ç‚¹ |
| cache_manager.exe | 5B4C3D2E1F0A9B8C | traceId-987 | å­èŠ‚ç‚¹ |
| http_module.exe | 1B0C9D8E7F6A5B4C | traceId-987 | å­™èŠ‚ç‚¹ |
| ssl_module.exe | 2C1D0E9F8A7B6C5D | traceId-987 | å­™èŠ‚ç‚¹ |
| cache_loader.exe | 3D2E1F0A9B8C7D6E | traceId-987 | å­™èŠ‚ç‚¹ |
| cache_purger.exe | 4E3F2A1B0C9D8E7F | traceId-987 | å­™èŠ‚ç‚¹ |
| php-cgi.exe | E3E5C129C46B2229 | traceId-987 | å­èŠ‚ç‚¹ |
| xp.cn_cgi.exe | A85889BAF0885BEA | traceId-parent-C46B2113 | çˆ¶èŠ‚ç‚¹åˆ†æ”¯ |
| explorer.exe | F9A8B7C6D5E4F3A2 | traceId-grandpa-C98F16A8 | ç¥–çˆ¶èŠ‚ç‚¹åˆ†æ”¯ |
| notepad.exe | A9B8C7D6E5F4A3B2 | traceId-grandpa-C98F16A8 | ç¥–çˆ¶èŠ‚ç‚¹åˆ†æ”¯ |
| calc.exe | B8C7D6E5F4A3B2C1 | traceId-grandpa-C98F16A8 | ç¥–çˆ¶èŠ‚ç‚¹åˆ†æ”¯ |
| mspaint.exe | C7D6E5F4A3B2C1D0 | traceId-grandpa-C98F16A8 | ç¥–çˆ¶èŠ‚ç‚¹åˆ†æ”¯ |
| cmd.exe | D6E5F4A3B2C1D0E9 | traceId-grandpa-C98F16A8 | ç¥–çˆ¶èŠ‚ç‚¹åˆ†æ”¯ |

âœ… **è§„åˆ™ç¬¦åˆ**:
- æ ¹èŠ‚ç‚¹ `nginx.exe`: `processGuid == traceId-987`
- æ‰€æœ‰å­å­™èŠ‚ç‚¹: `traceId == traceId-987`
- çˆ¶èŠ‚ç‚¹åŠå…¶åˆ†æ”¯: `traceId == traceId-parent-C46B2113`
- ç¥–çˆ¶èŠ‚ç‚¹åŠå…¶åˆ†æ”¯: `traceId == traceId-grandpa-C98F16A8`
- æ ¹èŠ‚ç‚¹å‘ä¸Šæœ€å¤š2å±‚: phpstudy_pro (çˆ¶) â†’ RuntimeBroker (ç¥–çˆ¶)

## èŠ‚ç‚¹ç»Ÿè®¡

- **ç½‘ä¾§**: 1ä¸ªalertï¼ˆwebshellä¸Šä¼ ï¼‰
- **ç«¯ä¾§è¿›ç¨‹**: 17ä¸ª
- **æ–‡ä»¶**: 1ä¸ª (bello.php)
- **æ³¨å†Œè¡¨**: 1ä¸ª (æŒä¹…åŒ–)
- **æ€»è®¡**: 20ä¸ªèŠ‚ç‚¹
