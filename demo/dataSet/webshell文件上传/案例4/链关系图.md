# Webshellæ–‡ä»¶ä¸Šä¼  - æ¡ˆä¾‹4 é“¾å…³ç³»å›¾

## å®Œæ•´æ”»å‡»é“¾è§†å›¾ï¼ˆ40ä¸ªèŠ‚ç‚¹ï¼‰

```
ğŸŒ [ç½‘ä¾§] æ£€æµ‹åˆ°ä¸Šä¼ å†°èwebshellæ–‡ä»¶(PHP)
æ¥æº: 10.50.86.153:51343 â†’ ç›®çš„: 10.50.112.195:80 (HTTP)
å¨èƒ: Webshellåé—¨è®¿é—®äº‹ä»¶ [HIGH]
â”‚
â”‚ æ¡¥æ¥åˆ°ç«¯ä¾§è¿›ç¨‹æ ‘
â†“

ç«¯ä¾§ [Endpoint Side] - ä¸»æœº: 10.50.112.195
â”‚
services.exe (PID:766, SYSTEM) [ç¥–çˆ¶èŠ‚ç‚¹]
â””â”€â”€ svchost.exe (PID:898, SYSTEM) [çˆ¶èŠ‚ç‚¹]
    â””â”€â”€ â­ RuntimeBroker.exe (PID:426, Administrator) [ROOT,ALARM] ğŸš¨æ ¹èŠ‚ç‚¹
        â”œâ”€â”€ phpstudy_pro.exe (PID:6994) [æ”»å‡»åˆ†æ”¯]
        â”‚   â””â”€â”€ xp.cn_cgi.exe (PID:3042)
        â”‚       â”œâ”€â”€ php.exe (PID:3043)
        â”‚       â”œâ”€â”€ php-fpm.exe (PID:3044)
        â”‚       â”œâ”€â”€ phpinfo.exe (PID:3045)
        â”‚       â”œâ”€â”€ composer.exe (PID:3046)
        â”‚       â””â”€â”€ ğŸ“„ shell.php (Backdoor/PHP.WebShell.ek) [HIGH]
        â”‚
        â”œâ”€â”€ explorer.exe (PID:4001) [æ­£å¸¸åˆ†æ”¯1]
        â”‚   â”œâ”€â”€ notepad.exe (PID:4002)
        â”‚   â”œâ”€â”€ calc.exe (PID:4003)
        â”‚   â”œâ”€â”€ mspaint.exe (PID:4004)
        â”‚   â””â”€â”€ cmd.exe (PID:4005)
        â”‚
        â”œâ”€â”€ taskmgr.exe (PID:4006) [æ­£å¸¸åˆ†æ”¯2]
        â”œâ”€â”€ conhost.exe (PID:4007) [æ­£å¸¸åˆ†æ”¯3]
        â”‚
        â”œâ”€â”€ chrome.exe (PID:4008) [æ­£å¸¸åˆ†æ”¯4]
        â”‚   â”œâ”€â”€ chrome.exe (PID:4009) --type=renderer
        â”‚   â””â”€â”€ chrome.exe (PID:4010) --type=gpu-process
        â”‚
        â”œâ”€â”€ powershell.exe (PID:4011) [æ­£å¸¸åˆ†æ”¯5]
        â”œâ”€â”€ regedit.exe (PID:4012) [æ­£å¸¸åˆ†æ”¯6]
        â”œâ”€â”€ mmc.exe (PID:4013) [æ­£å¸¸åˆ†æ”¯7]
        â”‚
        â”œâ”€â”€ winword.exe (PID:4014) [Officeåˆ†æ”¯]
        â”œâ”€â”€ excel.exe (PID:4015)
        â”œâ”€â”€ outlook.exe (PID:4016)
        â”‚
        â”œâ”€â”€ WeChat.exe (PID:4017) [ç¤¾äº¤è½¯ä»¶åˆ†æ”¯]
        â”‚   â””â”€â”€ WeChatApp.exe (PID:4018)
        â”‚
        â”œâ”€â”€ QQ.exe (PID:4019)
        â”‚   â””â”€â”€ QQScLauncher.exe (PID:4020)
        â”‚
        â”œâ”€â”€ DingTalk.exe (PID:4021) [ä¼ä¸šåº”ç”¨åˆ†æ”¯]
        â”œâ”€â”€ wps.exe (PID:4022)
        â”‚
        â””â”€â”€ vmware.exe (PID:4023) [è™šæ‹ŸåŒ–åˆ†æ”¯]
            â””â”€â”€ vmware-vmx.exe (PID:4024)
```

## æ”»å‡»é“¾è¯´æ˜

### 1. åˆå§‹å…¥ä¾µ (Initial Access)
- **ç½‘ä¾§å‘Šè­¦**: 10.50.86.153 é€šè¿‡HTTPä¸Šä¼ å†°èwebshellåˆ° 10.50.112.195:80
- **æ”»å‡»æ‰‹æ³•**: TA0001/T1190 - åˆ©ç”¨é¢å‘å…¬ä¼—çš„åº”ç”¨ç¨‹åº

### 2. æ‰§è¡Œ (Execution)
- **æ ¹èŠ‚ç‚¹**: `RuntimeBroker.exe` (PID:426) - Windowsç³»ç»Ÿè¿›ç¨‹ï¼Œä½œä¸ºç”¨æˆ·çº§åº”ç”¨çš„å®¿ä¸»
  - `processGuid = traceId-988` (æ ¹èŠ‚ç‚¹æ ‡è¯†)
  - å‘ä¸Šæº¯æº: svchost.exe (çˆ¶) â†’ services.exe (ç¥–çˆ¶)
- **æ”»å‡»åˆ†æ”¯**: phpstudy_pro â†’ xp.cn_cgi â†’ æ¶æ„webshellæ–‡ä»¶
- **æ­£å¸¸åˆ†æ”¯**: åŒ…å«30+ä¸ªæ­£å¸¸ç”¨æˆ·è¿›ç¨‹ï¼Œæ¨¡æ‹ŸçœŸå®ç”Ÿäº§ç¯å¢ƒ

### 3. è¿›ç¨‹æ ‘ç»“æ„

#### æ”»å‡»åˆ†æ”¯ï¼ˆ6ä¸ªèŠ‚ç‚¹ï¼‰
- `phpstudy_pro.exe` â†’ `xp.cn_cgi.exe` â†’ `php.exe`, `php-fpm.exe`, `phpinfo.exe`, `composer.exe`
- æ¶æ„æ–‡ä»¶: `shell.php` (Backdoor/PHP.WebShell.ek)

#### æ­£å¸¸ç”¨æˆ·åˆ†æ”¯ï¼ˆ30+ä¸ªèŠ‚ç‚¹ï¼‰
1. **æ–‡ä»¶ç®¡ç†**: explorer.exe + 4ä¸ªå­è¿›ç¨‹
2. **ç³»ç»Ÿå·¥å…·**: taskmgr, conhost, powershell, regedit, mmc
3. **æµè§ˆå™¨**: chrome.exe + 2ä¸ªå­è¿›ç¨‹
4. **åŠå…¬è½¯ä»¶**: winword, excel, outlook
5. **ç¤¾äº¤è½¯ä»¶**: WeChat + å­è¿›ç¨‹, QQ + å­è¿›ç¨‹
6. **ä¼ä¸šåº”ç”¨**: DingTalk, wps
7. **è™šæ‹ŸåŒ–**: vmware + vmware-vmx

## ProcessGuid/ParentProcessGuid è¿æ¥å…³ç³»

| è¿›ç¨‹ | ProcessGuid | ParentProcessGuid | TraceId | å…³ç³» |
|------|-------------|-------------------|---------|------|
| services.exe | FEC814366B473FAB | "" | traceId-other-FEC81436 | ç³»ç»Ÿæ ¹è¿›ç¨‹ |
| svchost.exe | 1E4EA91360FA096 | FEC814366B473FAB | **traceId-parent-1E4EA913** | çˆ¶èŠ‚ç‚¹ |
| **RuntimeBroker.exe** [ROOT] | **traceId-988** | 1E4EA91360FA096 | **traceId-988** | ğŸš¨æ ¹èŠ‚ç‚¹ |
| phpstudy_pro.exe | E3E5C129C46B2114 | traceId-988 | traceId-988 | æ”»å‡»å­èŠ‚ç‚¹ |
| xp.cn_cgi.exe | A85889BAF0885BE9 | E3E5C129C46B2114 | traceId-988 | æ”»å‡»å­™èŠ‚ç‚¹ |
| php.exe | B1A2B3C4D5E6F7A8 | A85889BAF0885BE9 | traceId-988 | æ”»å‡»æ›¾å­™èŠ‚ç‚¹ |
| php-fpm.exe | C2B3C4D5E6F7A8B9 | A85889BAF0885BE9 | traceId-988 | æ”»å‡»æ›¾å­™èŠ‚ç‚¹ |
| phpinfo.exe | D3C4D5E6F7A8B9C0 | A85889BAF0885BE9 | traceId-988 | æ”»å‡»æ›¾å­™èŠ‚ç‚¹ |
| composer.exe | E4D5E6F7A8B9C0D1 | A85889BAF0885BE9 | traceId-988 | æ”»å‡»æ›¾å­™èŠ‚ç‚¹ |
| explorer.exe | F5E6F7A8B9C0D1E2 | traceId-988 | traceId-988 | æ­£å¸¸å­èŠ‚ç‚¹ |
| notepad.exe | A6B7C8D9E0F1A2B3 | F5E6F7A8B9C0D1E2 | traceId-988 | æ­£å¸¸å­™èŠ‚ç‚¹ |
| calc.exe | B7C8D9E0F1A2B3C4 | F5E6F7A8B9C0D1E2 | traceId-988 | æ­£å¸¸å­™èŠ‚ç‚¹ |
| mspaint.exe | C8D9E0F1A2B3C4D5 | F5E6F7A8B9C0D1E2 | traceId-988 | æ­£å¸¸å­™èŠ‚ç‚¹ |
| cmd.exe | D9E0F1A2B3C4D5E6 | F5E6F7A8B9C0D1E2 | traceId-988 | æ­£å¸¸å­™èŠ‚ç‚¹ |
| taskmgr.exe | E0F1A2B3C4D5E6F7 | traceId-988 | traceId-988 | æ­£å¸¸å­èŠ‚ç‚¹ |
| conhost.exe | F1A2B3C4D5E6F7A8 | traceId-988 | traceId-988 | æ­£å¸¸å­èŠ‚ç‚¹ |
| chrome.exe | A2B3C4D5E6F7A8B9 | traceId-988 | traceId-988 | æ­£å¸¸å­èŠ‚ç‚¹ |
| chrome.exe (renderer) | B3C4D5E6F7A8B9C0 | A2B3C4D5E6F7A8B9 | traceId-988 | æ­£å¸¸å­™èŠ‚ç‚¹ |
| chrome.exe (gpu) | C4D5E6F7A8B9C0D1 | A2B3C4D5E6F7A8B9 | traceId-988 | æ­£å¸¸å­™èŠ‚ç‚¹ |
| powershell.exe | D5E6F7A8B9C0D1E2 | traceId-988 | traceId-988 | æ­£å¸¸å­èŠ‚ç‚¹ |
| regedit.exe | E6F7A8B9C0D1E2F3 | traceId-988 | traceId-988 | æ­£å¸¸å­èŠ‚ç‚¹ |
| mmc.exe | F7A8B9C0D1E2F3A4 | traceId-988 | traceId-988 | æ­£å¸¸å­èŠ‚ç‚¹ |
| winword.exe | A8B9C0D1E2F3A4B5 | traceId-988 | traceId-988 | æ­£å¸¸å­èŠ‚ç‚¹ |
| excel.exe | B9C0D1E2F3A4B5C6 | traceId-988 | traceId-988 | æ­£å¸¸å­èŠ‚ç‚¹ |
| outlook.exe | C0D1E2F3A4B5C6D7 | traceId-988 | traceId-988 | æ­£å¸¸å­èŠ‚ç‚¹ |
| WeChat.exe | D1E2F3A4B5C6D7E8 | traceId-988 | traceId-988 | æ­£å¸¸å­èŠ‚ç‚¹ |
| WeChatApp.exe | E2F3A4B5C6D7E8F9 | D1E2F3A4B5C6D7E8 | traceId-988 | æ­£å¸¸å­™èŠ‚ç‚¹ |
| QQ.exe | F3A4B5C6D7E8F9A0 | traceId-988 | traceId-988 | æ­£å¸¸å­èŠ‚ç‚¹ |
| QQScLauncher.exe | A4B5C6D7E8F9A0B1 | F3A4B5C6D7E8F9A0 | traceId-988 | æ­£å¸¸å­™èŠ‚ç‚¹ |
| DingTalk.exe | B5C6D7E8F9A0B1C2 | traceId-988 | traceId-988 | æ­£å¸¸å­èŠ‚ç‚¹ |
| wps.exe | C6D7E8F9A0B1C2D3 | traceId-988 | traceId-988 | æ­£å¸¸å­èŠ‚ç‚¹ |
| vmware.exe | D7E8F9A0B1C2D3E4 | traceId-988 | traceId-988 | æ­£å¸¸å­èŠ‚ç‚¹ |
| vmware-vmx.exe | E8F9A0B1C2D3E4F5 | D7E8F9A0B1C2D3E4 | traceId-988 | æ­£å¸¸å­™èŠ‚ç‚¹ |

âœ… **è§„åˆ™ç¬¦åˆ**:
- æ ¹èŠ‚ç‚¹ `RuntimeBroker.exe`: `processGuid == traceId-988`, `isRoot == true`, `isAlarm == true`
- æ‰€æœ‰å­å­™èŠ‚ç‚¹: `parentProcessGuid` æŒ‡å‘å…¶çˆ¶èŠ‚ç‚¹çš„ `processGuid`, ä¸” `traceId == traceId-988`
- çˆ¶èŠ‚ç‚¹ svchost: `processGuid == 1E4EA91360FA096`, `traceId == traceId-parent-1E4EA913`
- ç¥–çˆ¶èŠ‚ç‚¹ services: `processGuid == FEC814366B473FAB`, `traceId == traceId-other-FEC81436`
- æ ¹èŠ‚ç‚¹å‘ä¸Šæœ€å¤š2å±‚: svchost (çˆ¶) â†’ services (ç¥–çˆ¶)
- æ ¹èŠ‚ç‚¹ä¸‹æœ‰34ä¸ªå­è¿›ç¨‹ï¼Œå½¢æˆä¸°å¯Œçš„è¿›ç¨‹æ ‘

## IPåœ°å€ä¸€è‡´æ€§

æ‰€æœ‰ç«¯ä¾§æ—¥å¿—ä½¿ç”¨ç»Ÿä¸€IP: **10.50.112.195**
- hostAddress: 10.50.112.195
- srcAddress: 10.50.112.195
- destAddress: 10.50.112.195

## èŠ‚ç‚¹ç»Ÿè®¡

- **ç½‘ä¾§**: 1ä¸ªalertï¼ˆwebshellä¸Šä¼ ï¼‰
- **ç«¯ä¾§è¿›ç¨‹**: 38ä¸ª
  - ç³»ç»Ÿè¿›ç¨‹: 2ä¸ª (services, svchost)
  - æ ¹èŠ‚ç‚¹: 1ä¸ª (RuntimeBroker)
  - æ”»å‡»åˆ†æ”¯: 5ä¸ª (phpstudy_pro, xp.cn_cgi, php, php-fpm, phpinfo, composer)
  - æ­£å¸¸åˆ†æ”¯: 30ä¸ªï¼ˆexploreråˆ†æ”¯4ä¸ªï¼Œchromeåˆ†æ”¯2ä¸ªï¼ŒOffice 3ä¸ªï¼Œç¤¾äº¤è½¯ä»¶4ä¸ªï¼Œå…¶ä»–17ä¸ªï¼‰
- **æ–‡ä»¶**: 1ä¸ª (shell.php)
- **æ€»è®¡**: 40ä¸ªèŠ‚ç‚¹

## æŸ¥è¯¢æµç¨‹è¯´æ˜

1. **ç¬¬ä¸€æ­¥**: æ ¹æ® `traceId-988` æŸ¥è¯¢æ‰€æœ‰ç›¸å…³æ—¥å¿—
   - æ‰¾åˆ°æ ¹èŠ‚ç‚¹: RuntimeBroker.exe (`processGuid == traceId-988`, `isRoot == true`)
   - æ‰¾åˆ°æ‰€æœ‰å­å­™èŠ‚ç‚¹: 34ä¸ªè¿›ç¨‹ + 1ä¸ªæ–‡ä»¶ (`traceId == traceId-988`)

2. **ç¬¬äºŒæ­¥**: é€šè¿‡ `processGuid` å’Œ `parentProcessGuid` å‘ä¸Šæº¯æº
   - RuntimeBroker.exe çš„ `parentProcessGuid == 1E4EA91360FA096`
   - æŸ¥è¯¢å¾—åˆ°çˆ¶èŠ‚ç‚¹: svchost.exe (`processGuid == 1E4EA91360FA096`)
   - svchost.exe çš„ `parentProcessGuid == FEC814366B473FAB`
   - æŸ¥è¯¢å¾—åˆ°ç¥–çˆ¶èŠ‚ç‚¹: services.exe (`processGuid == FEC814366B473FAB`)

3. **ç¬¬ä¸‰æ­¥**: æ„å»ºå®Œæ•´è¿›ç¨‹æ ‘
   - æ‰€æœ‰èŠ‚ç‚¹å‡å¯é€šè¿‡ `processGuid/parentProcessGuid` å…³ç³»è¿æ¥
   - æœ€ç»ˆç”Ÿæˆä» services åˆ°æ‰€æœ‰34ä¸ªå­å­™è¿›ç¨‹çš„å®Œæ•´æ ‘çŠ¶ç»“æ„
   - æ”»å‡»åˆ†æ”¯æ··æ‚åœ¨30+ä¸ªæ­£å¸¸è¿›ç¨‹ä¸­ï¼Œæ¨¡æ‹ŸçœŸå®ç”Ÿäº§ç¯å¢ƒ

## ä¸šåŠ¡åœºæ™¯è¯´æ˜

è¯¥æ¡ˆä¾‹æ¨¡æ‹ŸçœŸå®ç”Ÿäº§ç¯å¢ƒï¼ŒRuntimeBrokerä½œä¸ºæ ¹èŠ‚ç‚¹æ‰¿è½½äº†å¤§é‡ç”¨æˆ·çº§åº”ç”¨ï¼š
- **æ”»å‡»éšè”½æ€§**: æ¶æ„è¿›ç¨‹ï¼ˆphpstudy_pro â†’ xp.cn_cgiï¼‰æ··æ‚åœ¨30+ä¸ªæ­£å¸¸è¿›ç¨‹ä¸­
- **çœŸå®åœºæ™¯**: åŒ…å«åŠå…¬è½¯ä»¶(Office)ã€ç¤¾äº¤åº”ç”¨(å¾®ä¿¡/QQ)ã€ä¼ä¸šå·¥å…·(é’‰é’‰/WPS)ã€è™šæ‹ŸåŒ–(VMware)ç­‰
- **æ£€æµ‹æŒ‘æˆ˜**: éœ€è¦åœ¨å¤§é‡æ­£å¸¸è¿›ç¨‹ä¸­è¯†åˆ«å¼‚å¸¸çš„webshellä¸Šä¼ å’Œæ‰§è¡Œè¡Œä¸º
