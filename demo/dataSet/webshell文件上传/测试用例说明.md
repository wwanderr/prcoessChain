# WebShell攻击测试用例说明

## 快速开始

### 1. 案例1 - 基础测试
```bash
# 测试基础进程链构建
输入: 案例1/endpoint1.json + 案例1/network1.json
预期: 2节点进程链，根节点为php-cgi.exe
验证: 网端关联正确，traceId一致
```

### 2. 案例2 - 长链测试
```bash
# 测试线性长链处理
输入: 案例2/endpoint1-4.json + 案例2/network1.json
预期: 4节点线性链，无分支
验证: 时间顺序正确，父子关系完整
```

### 3. 案例3 - 分支测试
```bash
# 测试分支链处理
输入: 案例3/endpoint1-5.json + 案例3/network1.json
预期: 5节点分支链，2个分支
验证: 分支正确识别，独立性保持
```

### 4. 案例4 - 断链测试
```bash
# 测试断链处理
输入: 案例4/endpoint1-3.json + 案例4/network1.json
预期: 3节点主链 + 1个独立进程
验证: 断链正确检测，独立进程处理
```

## 关键验证点

### 进程链构建
- [ ] 根节点识别: `processGuid = "E3E5C129C46B2111"`
- [ ] 父子关系: `parentProcessGuid` 正确匹配
- [ ] 时间顺序: `processStartTime` 递增
- [ ] 链完整性: 无缺失节点

### 网端关联
- [ ] IP匹配: 端点IP与网络IP一致
- [ ] 时间窗口: 网络时间与端点时间重叠
- [ ] 机构匹配: `srcOrgId` 和 `destOrgId` 一致
- [ ] 安全域: `srcSecurityZone` 和 `destSecurityZone` 匹配

### 特殊场景
- [ ] 分支处理: 一个父进程多个子进程
- [ ] 断链检测: `parentProcessId = 0` 的进程
- [ ] IP隔离: 不同IP的进程链不混淆
- [ ] 空值处理: 缺失字段的正确处理

## 预期结果

### 案例1结果
```json
{
  "nodes": 2,
  "edges": 1,
  "rootNode": "E3E5C129C46B2111",
  "chainType": "linear",
  "ipAddress": "10.50.109.192"
}
```

### 案例2结果
```json
{
  "nodes": 4,
  "edges": 3,
  "rootNode": "E3E5C129C46B2111",
  "chainType": "linear",
  "ipAddress": "192.168.1.101",
  "path": ["php-cgi", "cmd", "powershell", "reg"]
}
```

### 案例3结果
```json
{
  "nodes": 5,
  "edges": 4,
  "rootNode": "E3E5C129C46B2111",
  "chainType": "branch",
  "ipAddress": "192.168.1.102",
  "branches": [
    ["php-cgi", "cmd", "powershell", "reg"],
    ["php-cgi", "cmd", "powershell", "netstat"]
  ]
}
```

### 案例4结果
```json
{
  "nodes": 4,
  "edges": 2,
  "rootNode": "E3E5C129C46B2111",
  "chainType": "broken",
  "ipAddress": "192.168.1.103",
  "mainChain": ["php-cgi", "cmd"],
  "isolatedProcess": "notepad"
}
```

## 性能指标

| 案例 | 节点数 | 预期处理时间 | 内存使用 | 复杂度 |
|------|--------|--------------|----------|--------|
| 案例1 | 2 | < 100ms | < 10MB | O(1) |
| 案例2 | 4 | < 200ms | < 20MB | O(n) |
| 案例3 | 5 | < 300ms | < 30MB | O(n) |
| 案例4 | 4 | < 250ms | < 25MB | O(n) |

## 故障排除

### 常见问题
1. **链构建失败**: 检查 `processGuid` 和 `parentProcessGuid` 匹配
2. **网端关联失败**: 验证IP地址和时间窗口
3. **分支识别错误**: 检查同一父进程的多个子进程
4. **断链检测失败**: 验证 `parentProcessId = 0` 的进程

### 调试建议
- 启用详细日志记录
- 检查时间戳格式
- 验证JSON数据完整性
- 监控内存使用情况
