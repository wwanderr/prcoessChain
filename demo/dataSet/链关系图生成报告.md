# 链关系图生成完成报告

生成时间: 2025-11-03

## 概述

已成功为所有12个测试案例生成链关系图，使用 `ChainVisualizer.java` 工具从 `test_data.txt` 文件中提取数据并生成可视化的Markdown文档。

## 生成工具

- **工具名称**: `ChainVisualizer.java`
- **位置**: `dataSet/java/ChainVisualizer.java`
- **批处理脚本**: `dataSet/generate_chains.bat`

## 生成结果

### 1. Webshell文件上传场景

| 案例 | 链关系图文件 | 进程节点数 | 状态 |
|------|-------------|-----------|------|
| 案例2 | `webshell文件上传/案例2/链关系图.md` | 3 | ✅ 已生成 |
| 案例3 | `webshell文件上传/案例3/链关系图.md` | 21 | ✅ 已生成 |
| 案例4 | `webshell文件上传/案例4/链关系图.md` | - | ✅ 已生成 |
| 案例5 | `webshell文件上传/案例5/链关系图.md` | - | ✅ 已生成 |

**特点**:
- 案例2: 断链场景，只有父进程链和文件日志
- 案例3: 完整进程树，包含22个进程节点和多层级结构
  - 根节点: `nginx.exe` (PID:2001)
  - 包含worker进程、cache管理进程等多个分支

### 2. 命令执行场景

| 案例 | 链关系图文件 | 进程节点数 | 状态 |
|------|-------------|-----------|------|
| 案例2 | `命令执行/案例2/链关系图.md` | 9 | ✅ 已生成 |
| 案例3 | `命令执行/案例3/链关系图.md` | - | ✅ 已生成 |
| 案例4 | `命令执行/案例4/链关系图.md` | - | ✅ 已生成 |
| 案例5 | `命令执行/案例5/链关系图.md` | - | ✅ 已生成 |

**特点**:
- 展示命令执行攻击链
- 包含网络攻击源和恶意文件创建

### 3. 矿池场景

| 案例 | 链关系图文件 | 进程节点数 | 状态 |
|------|-------------|-----------|------|
| 案例2 | `矿池/案例2/链关系图.md` | 8 | ✅ 已生成 |
| 案例3 | `矿池/案例3/链关系图.md` | - | ✅ 已生成 |
| 案例4 | `矿池/案例4/链关系图.md` | - | ✅ 已生成 |
| 案例5 | `矿池/案例5/链关系图.md` | - | ✅ 已生成 |

**特点**:
- 案例2: 显示两个并行的进程分支（断链）
- 展示矿池连接和DNS查询

## 链关系图格式

每个链关系图包含以下部分：

### 1. 图例说明
- 🌐 网络攻击源
- 💻 进程节点
- 📄 文件节点
- [ROOT] 根节点（告警进程）
- [ALARM] 告警节点
- [EXTEND] 扩展节点（有子进程的节点）
- 威胁等级: HIGH (高) | MEDIUM (中) | LOW (低)

### 2. 完整进程树视图
树状结构展示，包含：
- 网络攻击源 (IP:Port → IP:Port)
- 进程节点 (进程名 + PID + 用户名 + 威胁等级)
- 文件节点 (文件名 + 病毒名)

### 3. 统计信息
- 进程节点数
- 文件节点数
- 网络节点数
- 总节点数
- 根进程数
- 告警进程
- 恶意文件

## TraceID分配规则

已按照以下规则修复所有测试案例的traceId:

### 核心规则
1. **每个案例只有一个根节点**
2. **根节点**: `processGuid == traceId` (例如: `processGuid: "traceId-987"`, `traceId: "traceId-987"`)
3. **根节点的所有子孙**: 使用相同的 `traceId` (例如: `traceId-987`)
4. **根节点的所有祖先**: 使用不同的 `traceId` (例如: `traceId-parent-xxx`)

### 示例 (案例3)
```
根节点 (L0): nginx.exe 
  processGuid: traceId-987
  traceId: traceId-987

向下子孙进程 (全部 traceId-987):
├─ worker_process.exe → traceId-987
├─ http_module.exe → traceId-987
├─ ssl_module.exe → traceId-987
├─ cache_manager.exe → traceId-987
├─ cache_loader.exe → traceId-987
└─ cache_purger.exe → traceId-987

向上父辈 (全部不是 traceId-987):
├─ phpstudy_pro.exe → traceId-parent-E3E5C129
├─ RuntimeBroker.exe → traceId-parent-BCA9487D
├─ svchost.exe → traceId-parent-1E4EA913
└─ services.exe → traceId-parent-FEC814
```

## 如何使用

### 重新生成所有链关系图
```batch
cd demo/dataSet
.\generate_chains.bat
```

### 生成单个案例的链关系图
```batch
cd demo/dataSet/java
java -cp ".;..\..\target\classes;C:\Users\18395\.m2\repository\..." ChainVisualizer "..\webshell文件上传\案例3\test_data.txt"
```

## 验证结果

所有12个案例的链关系图已经成功生成并验证：

✅ **Webshell文件上传**: 案例2, 案例3, 案例4, 案例5  
✅ **命令执行**: 案例2, 案例3, 案例4, 案例5  
✅ **矿池**: 案例2, 案例3, 案例4, 案例5  

## 备注

- 案例1 (每个场景的endpoint1.json和network1.json) 不需要生成链关系图，因为它们是模板文件
- 支持断链场景：当某些进程日志缺失时，仍然可以显示可用的进程树结构
- 支持并行分支：可以显示同一父进程下的多个子进程分支
- 自动识别根节点：通过 `processGuid == traceId` 规则识别

---

生成工具版本: v1.0  
最后更新: 2025-11-03


